<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лаб.работа 25. Зависимость периода от длины нити</title>
    <style>
        :root {
            --primary: #34495e;
            --accent: #1abc9c; /* Бирюзовый акцент */
            --bg: #f0f3f4;
            --panel: #ffffff;
            --text: #2c3e50;
            --radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.2rem; }

        .lang-switch {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .lang-switch:hover { background: rgba(255,255,255,0.3); }

        /* --- MAIN LAYOUT --- */
        .main-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 10px;
            gap: 15px;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 380px;
            background: var(--panel);
            border-radius: var(--radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tabs { display: flex; background: #ecf0f1; }
        .tab-btn {
            flex: 1; padding: 12px; border: none; background: none;
            cursor: pointer; font-weight: 600; color: #7f8c8d;
            border-bottom: 3px solid transparent;
        }
        .tab-btn.active {
            background: #fff; color: var(--primary); border-bottom-color: var(--accent);
        }

        .tab-content { padding: 20px; overflow-y: auto; flex: 1; display: none; }
        .tab-content.active { display: block; }

        /* --- CONTROLS --- */
        .control-group { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; }
        
        input[type="range"] { 
            width: 100%; padding: 8px; cursor: pointer; accent-color: var(--accent);
        }
        
        .val-display { float: right; font-weight: bold; color: var(--accent); }

        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 4px;
            cursor: pointer; font-weight: bold; margin-bottom: 10px; transition: 0.2s; color: white;
        }
        .btn-reset { background-color: #e74c3c; }
        .btn-reset:hover { background-color: #c0392b; }
        .btn-record { background-color: var(--primary); }
        .btn-record:hover { background-color: #1a252f; }

        .formula-box {
            background: #e8f8f5; border-left: 4px solid var(--accent);
            padding: 10px; margin: 10px 0; font-family: monospace; text-align: center;
        }

        /* --- SIMULATION --- */
        .sim-container {
            flex: 1;
            background: radial-gradient(circle at center, #ffffff, #eaecee);
            border-radius: var(--radius);
            border: 1px solid #dcdcdc;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        svg { width: 100%; height: 100%; cursor: default; }

        /* SVG Elements */
        .thread { stroke: #2c3e50; stroke-width: 2; }
        .pivot-bar { stroke: #7f8c8d; stroke-width: 6; stroke-linecap: round; }
        .sensor-beam { stroke: #e74c3c; stroke-width: 1; stroke-dasharray: 4; opacity: 0.4; }
        
        /* Ruler */
        .ruler-bg { fill: #fcf3cf; stroke: #f1c40f; stroke-width: 1; }
        .ruler-tick { stroke: #7f8c8d; stroke-width: 1; }
        .ruler-text { font-size: 10px; fill: #7f8c8d; text-anchor: end; }

        /* Digital Display */
        .digital-display {
            position: absolute; top: 20px; right: 20px;
            background: #34495e; color: #1abc9c;
            padding: 15px; border-radius: 6px;
            font-family: 'Courier New', monospace;
            border: 2px solid #2c3e50;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            min-width: 160px;
        }
        .display-label { color: #bdc3c7; font-size: 0.8rem; display: block; }
        .display-val { font-size: 1.5rem; font-weight: bold; }
        .display-sub { font-size: 0.8rem; color: #fff; border-top: 1px solid #555; margin-top: 5px; padding-top: 5px;}

        /* Hint */
        .hint {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); color: white; padding: 8px 16px;
            border-radius: 20px; pointer-events: none; opacity: 1; font-size: 0.9rem; transition: opacity 0.5s;
        }

        /* Table */
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
        th { background-color: #ecf0f1; }

    </style>
</head>
<body>

<header>
    <h1 id="lab-title">Лаб.работа 25. Зависимость периода колебания нитяного маятника от длины подвеса</h1>
    <button class="lang-switch" onclick="toggleLang()">RU / KZ</button>
</header>

<div class="main-wrapper">
    
    <div class="sidebar">
        <div class="tabs">
            <button class="tab-btn active" onclick="setTab('setup')" id="tab-setup">Установка</button>
            <button class="tab-btn" onclick="setTab('theory')" id="tab-theory">Теория</button>
            <button class="tab-btn" onclick="setTab('journal')" id="tab-journal">Журнал</button>
        </div>

        <div id="setup" class="tab-content active">
            
            <div class="control-group">
                <label id="lbl-len">Длина нити L (см): <span class="val-display" id="val-l">50</span></label>
                <input type="range" id="len-range" min="15" max="85" value="50" step="5" oninput="updateSettings()">
            </div>

            <div style="background: #e8f8f5; padding: 10px; border-radius: 4px; font-size: 0.9rem; margin-bottom: 20px;">
                <strong id="lbl-instr">Инструкция:</strong>
                <ol style="padding-left: 20px; margin: 5px 0;">
                    <li id="instr-1">Установите максимальную длину нити.</li>
                    <li id="instr-2">Отклоните шар и измерьте период.</li>
                    <li id="instr-3">Уменьшите длину на 10-15 см.</li>
                    <li id="instr-4">Повторите измерение.</li>
                    <li id="instr-5">Сделайте 4-5 измерений для разных длин.</li>
                </ol>
            </div>
            
            <div class="formula-box">
                T_theor = <span id="val-t-theor">1.42</span> c
            </div>

            <button class="btn btn-record" onclick="recordData()" id="btn-record">ЗАПИСАТЬ РЕЗУЛЬТАТ</button>
            <button class="btn btn-reset" onclick="resetSim()" id="btn-reset">СБРОС / СТОП</button>
        </div>

        <div id="theory" class="tab-content">
            <h3 id="th-goal">Цель работы</h3>
            <p id="th-goal-text">Экспериментально подтвердить зависимость периода колебания нитяного маятника от длины подвеса.</p>
            
            <h3 id="th-form">Формула периода</h3>
            <div class="formula-box">
                T = 2π√(L/g)
            </div>
            <p id="th-desc">
                Период колебаний математического маятника прямо пропорционален квадратному корню из длины нити. Это означает, что для увеличения периода в 2 раза, длину нити нужно увеличить в 4 раза.
            </p>
        </div>

        <div id="journal" class="tab-content">
            <h3 id="th-journal">Результаты измерений</h3>
            <div style="overflow-x: auto;">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>№</th>
                            <th>L (см)</th>
                            <th>√L</th>
                            <th>T_exp (с)</th>
                            <th>T_theo (с)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <button class="btn btn-reset" onclick="clearTable()" style="margin-top: 10px; background: #95a5a6;">Очистить таблицу</button>
        </div>
    </div>

    <div class="sim-container">
        
        <div class="digital-display">
            <span class="display-label" id="disp-lbl">PERIOD (T):</span>
            <span class="display-val" id="disp-t">--.--</span> s
            <div class="display-sub">Cycles: <span id="disp-count">0</span></div>
        </div>

        <svg id="scene" viewBox="0 0 400 500" preserveAspectRatio="xMidYMax meet">
            <defs>
                <radialGradient id="grad-ball" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" style="stop-color: #fff" />
                    <stop offset="100%" style="stop-color: #1abc9c" />
                </radialGradient>
            </defs>
            
            <line x1="100" y1="20" x2="300" y2="20" class="pivot-bar" />

            <g id="ruler-group" transform="translate(50, 20)">
                <rect x="0" y="0" width="30" height="450" class="ruler-bg" />
                </g>

            <g id="pendulum">
                <line id="string1" x1="-50" y1="-280" x2="0" y2="0" class="thread" />
                <line id="string2" x1="50" y1="-280" x2="0" y2="0" class="thread" />
                <circle id="ball" cx="0" cy="0" r="15" fill="url(#grad-ball)" stroke="#2c3e50" style="cursor: grab;" />
            </g>

            <line x1="200" y1="50" x2="200" y2="450" class="sensor-beam" />

        </svg>
        
        <div class="hint" id="hint-text">Отклоните шар и отпустите</div>
    </div>
</div>

<script>
    // === CONFIGURATION ===
    const PIXELS_PER_METER = 500; 
    const PIVOT_X = 200;
    const PIVOT_Y = 20;
    const G = 9.81;

    // State
    let lengthM = 0.5; // meters
    let angle = 0; // radians
    let velocity = 0; // angular velocity
    let isDragging = false;
    let isRunning = false;
    
    // Measurement Logic
    let lastCrossTime = 0;
    let cycleCount = 0;
    let measuredPeriod = 0;
    let lastSign = 0;

    // DOM Elements
    const ui = {
        pendulum: document.getElementById('pendulum'),
        string1: document.getElementById('string1'),
        string2: document.getElementById('string2'),
        ball: document.getElementById('ball'),
        dispT: document.getElementById('disp-t'),
        dispCount: document.getElementById('disp-count'),
        valL: document.getElementById('val-l'),
        valTTheor: document.getElementById('val-t-theor'),
        hint: document.getElementById('hint-text'),
        svg: document.getElementById('scene'),
        ruler: document.getElementById('ruler-group')
    };

    // === INIT ===
    function init() {
        drawRuler();
        updateSettings();
        renderPendulum();
    }

    function drawRuler() {
        // Draw ticks every 5cm (25px)
        const totalCm = 90;
        const pxPerCm = 5; // 500px = 100cm -> 5px/cm
        
        for (let cm = 0; cm <= totalCm; cm += 5) {
            const y = cm * pxPerCm;
            const isMajor = (cm % 10 === 0);
            const w = isMajor ? 20 : 10;
            
            const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
            tick.setAttribute("x1", 30); tick.setAttribute("y1", y);
            tick.setAttribute("x2", 30 - w); tick.setAttribute("y2", y);
            tick.setAttribute("class", "ruler-tick");
            ui.ruler.appendChild(tick);
            
            if (isMajor) {
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", 8); text.setAttribute("y", y + 3);
                text.setAttribute("class", "ruler-text");
                text.textContent = cm;
                ui.ruler.appendChild(text);
            }
        }
    }

    // === TABS ===
    function setTab(id) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.getElementById(id).classList.add('active');
    }

    // === SETTINGS ===
    function updateSettings() {
        lengthM = parseFloat(document.getElementById('len-range').value) / 100;
        ui.valL.innerText = (lengthM * 100).toFixed(0);
        
        // Theoretical Period
        const T = 2 * Math.PI * Math.sqrt(lengthM / G);
        ui.valTTheor.innerText = T.toFixed(3);
        
        if (!isRunning && !isDragging) {
            angle = 0;
            velocity = 0;
            renderPendulum();
        }
    }

    // === SIMULATION LOOP ===
    function startSim() {
        if (isRunning) return;
        if (Math.abs(angle) < 0.05) return;

        isRunning = true;
        ui.hint.style.opacity = 0;
        
        // Reset Counters
        cycleCount = 0;
        lastCrossTime = performance.now();
        measuredPeriod = 0;
        ui.dispT.innerText = "--.--";
        ui.dispCount.innerText = "0";
        lastSign = Math.sign(angle);

        let lastTime = performance.now();

        function animate(time) {
            if (!isRunning && !isDragging) return;
            const dt = (time - lastTime) / 1000; 
            lastTime = time;

            if (!isDragging) {
                const acc = -(G / lengthM) * Math.sin(angle);
                velocity += acc * dt;
                velocity *= 0.999; // Air resistance
                angle += velocity * dt;

                // Zero Crossing Detection
                if (Math.sign(angle) !== lastSign && Math.abs(angle) < 0.2) {
                    cycleCount += 0.5;
                    ui.dispCount.innerText = Math.floor(cycleCount);

                    if (cycleCount % 1 === 0 && cycleCount > 0) {
                        const now = performance.now();
                        const duration = (now - lastCrossTime) / 1000;
                        lastCrossTime = now;
                        measuredPeriod = duration;
                        ui.dispT.innerText = measuredPeriod.toFixed(3);
                    } else if (cycleCount === 0.5) {
                        lastCrossTime = performance.now();
                    }
                    
                    lastSign = Math.sign(angle) === 0 ? 1 : Math.sign(angle);
                }
            }

            renderPendulum();
            requestAnimationFrame(animate);
        }
        requestAnimationFrame(animate);
    }

    function renderPendulum() {
        const lenPx = lengthM * PIXELS_PER_METER;
        
        // Ball Pos relative to pivot
        const x = lenPx * Math.sin(angle);
        const y = lenPx * Math.cos(angle);
        
        const absX = PIVOT_X + x;
        const absY = PIVOT_Y + y;
        
        ui.ball.setAttribute('cx', absX);
        ui.ball.setAttribute('cy', absY);
        
        // Bifilar geometry (Pivot width 100px -> +/- 50 from center)
        ui.string1.setAttribute('x1', 150); ui.string1.setAttribute('y1', 20);
        ui.string1.setAttribute('x2', absX); ui.string1.setAttribute('y2', absY);
        
        ui.string2.setAttribute('x1', 250); ui.string2.setAttribute('y1', 20);
        ui.string2.setAttribute('x2', absX); ui.string2.setAttribute('y2', absY);
    }

    function resetSim() {
        isRunning = false;
        angle = 0;
        velocity = 0;
        cycleCount = 0;
        ui.dispT.innerText = "--.--";
        ui.dispCount.innerText = "0";
        ui.hint.style.opacity = 1;
        renderPendulum();
    }

    // === DRAG & DROP ===
    ui.ball.addEventListener('mousedown', (e) => {
        isDragging = true;
        isRunning = false;
        velocity = 0;
        ui.dispT.innerText = "--.--";
    });

    window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        
        const pt = ui.svg.createSVGPoint();
        pt.x = e.clientX; pt.y = e.clientY;
        const svgP = pt.matrixTransform(ui.svg.getScreenCTM().inverse());
        
        const dx = svgP.x - PIVOT_X;
        const dy = svgP.y - PIVOT_Y;
        
        angle = Math.atan2(dx, dy);
        
        // Limit angle
        if (angle > 1.0) angle = 1.0;
        if (angle < -1.0) angle = -1.0;

        renderPendulum();
    });

    window.addEventListener('mouseup', () => {
        if (isDragging) {
            isDragging = false;
            startSim();
        }
    });

    // === JOURNAL ===
    function recordData() {
        if (cycleCount < 1) return;
        
        const T_theo = 2 * Math.PI * Math.sqrt(lengthM / G);
        const sqrtL = Math.sqrt(lengthM).toFixed(2);
        
        const tbody = document.querySelector('#data-table tbody');
        const row = document.createElement('tr');
        const n = tbody.children.length + 1;
        
        row.innerHTML = `
            <td>${n}</td>
            <td>${(lengthM*100).toFixed(0)}</td>
            <td>${sqrtL}</td>
            <td>${measuredPeriod.toFixed(3)}</td>
            <td>${T_theo.toFixed(3)}</td>
        `;
        tbody.appendChild(row);
    }

    function clearTable() {
        document.querySelector('#data-table tbody').innerHTML = '';
    }

    // === LOCALIZATION ===
    let currentLang = 'ru';
    const dict = {
        ru: {
            title: "Лаб.работа 25. Зависимость периода колебания нитяного маятника от длины подвеса",
            tab1: "Установка", tab2: "Теория", tab3: "Журнал",
            lblL: "Длина нити L (см):",
            lblInstr: "Инструкция:",
            i1: "Установите максимальную длину нити.",
            i2: "Отклоните шар и измерьте период.",
            i3: "Уменьшите длину на 10-15 см.",
            i4: "Повторите измерение.",
            i5: "Сделайте 4-5 измерений для разных длин.",
            btnRec: "ЗАПИСАТЬ РЕЗУЛЬТАТ", btnRes: "СБРОС / СТОП",
            thGoal: "Цель работы", thGoalTx: "Экспериментально подтвердить зависимость периода колебания нитяного маятника от длины подвеса.",
            thForm: "Формула периода",
            thDesc: "Период колебаний прямо пропорционален квадратному корню из длины нити. При увеличении длины в 4 раза, период увеличивается в 2 раза.",
            thJ: "Результаты измерений", hint: "Отклоните шар и отпустите",
            dispLbl: "ПЕРИОД (T):", sub: "Колебаний:"
        },
        kz: {
            title: "Зертханалық жұмыс №25. Жіпті маятник тербеліс периодының аспа ұзындығына тәуелділігі",
            tab1: "Қондырғы", tab2: "Теория", tab3: "Журнал",
            lblL: "Жіп ұзындығы L (см):",
            lblInstr: "Нұсқаулық:",
            i1: "Жіптің максималды ұзындығын орнатыңыз.",
            i2: "Шарды ауытқытып, периодты өлшеңіз.",
            i3: "Ұзындықты 10-15 см-ге азайтыңыз.",
            i4: "Өлшеуді қайталаңыз.",
            i5: "Әртүрлі ұзындықтар үшін 4-5 өлшеу жүргізіңіз.",
            btnRec: "НӘТИЖЕНІ ЖАЗУ", btnRes: "ҚАЙТАРУ / ТОҚТАТУ",
            thGoal: "Жұмыс мақсаты", thGoalTx: "Жіпті маятниктің тербеліс периодының аспа ұзындығына тәуелділігін эксперимент жүзінде растау.",
            thForm: "Период формуласы",
            thDesc: "Тербеліс периоды жіп ұзындығының квадрат түбіріне тура пропорционал. Ұзындықты 4 есе арттырғанда, период 2 есе артады.",
            thJ: "Өлшеу нәтижелері", hint: "Шарды ауытқытып, жіберіңіз",
            dispLbl: "ПЕРИОД (T):", sub: "Циклдар:"
        }
    };

    function toggleLang() {
        currentLang = currentLang === 'ru' ? 'kz' : 'ru';
        const t = dict[currentLang];
        document.getElementById('lab-title').innerText = t.title;
        document.getElementById('tab-setup').innerText = t.tab1;
        document.getElementById('tab-theory').innerText = t.tab2;
        document.getElementById('tab-journal').innerText = t.tab3;
        document.getElementById('lbl-len').childNodes[0].nodeValue = t.lblL + " ";
        document.getElementById('lbl-instr').innerText = t.lblInstr;
        document.getElementById('instr-1').innerText = t.i1;
        document.getElementById('instr-2').innerText = t.i2;
        document.getElementById('instr-3').innerText = t.i3;
        document.getElementById('instr-4').innerText = t.i4;
        document.getElementById('instr-5').innerText = t.i5;
        document.getElementById('btn-record').innerText = t.btnRec;
        document.getElementById('btn-reset').innerText = t.btnRes;
        document.getElementById('th-goal').innerText = t.thGoal;
        document.getElementById('th-goal-text').innerText = t.thGoalTx;
        document.getElementById('th-form').innerText = t.thForm;
        document.getElementById('th-desc').innerText = t.thDesc;
        document.getElementById('th-journal').innerText = t.thJ;
        document.getElementById('hint-text').innerText = t.hint;
        document.getElementById('disp-lbl').innerText = t.dispLbl;
        document.querySelector('.display-sub').childNodes[0].nodeValue = t.sub + " ";
    }

    init();

</script>
</body>
</html>