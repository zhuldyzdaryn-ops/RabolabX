<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Лаб. работа №8: Условия равновесия рычага</title>
    <style>
        :root {
            --stand: #7f8c8d;
            --lever: #e67e22; /* Wood texture color */
            --weight: #f1c40f; /* Brass color */
            --bg: #ecf0f1;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* HEADER */
        header {
            background-color: #34495e;
            color: white;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-left {
            display: flex;
            flex-direction: column;
        }
        h1 { margin: 0; font-size: 1.2rem; }
        .goal { font-size: 0.9rem; font-style: italic; opacity: 0.9; margin-top: 5px; border-left: 3px solid #f39c12; padding-left: 10px; }

        .lang-switch {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            white-space: nowrap;
            margin-left: 20px;
        }
        .lang-switch:hover { background: rgba(255,255,255,0.3); }

        /* WORKSPACE */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 300px;
            background: white;
            padding: 15px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            z-index: 20;
        }

        .control-group {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }
        
        .weight-source {
            display: flex;
            justify-content: center;
            padding: 15px;
            border: 2px dashed #bdc3c7;
            border-radius: 5px;
            background: #fff;
            margin-top: 10px;
        }

        .weight-obj {
            width: 30px;
            height: 40px;
            background: linear-gradient(to right, #f1c40f, #f39c12, #f1c40f);
            border: 1px solid #b7950b;
            border-radius: 3px 3px 10px 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #5d4037;
            cursor: grab;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            position: relative;
        }
        .weight-obj::before {
            content: '';
            position: absolute;
            top: -5px; left: 10px;
            width: 10px; height: 5px;
            border: 2px solid #b7950b;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
        }

        /* SIMULATION */
        .sim-area {
            flex: 1;
            position: relative;
            background: radial-gradient(circle, #fff, #bdc3c7);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* LEVER SETUP */
        .lab-setup {
            position: relative;
            width: 800px;
            height: 400px;
        }

        /* Stand */
        .stand-base {
            position: absolute;
            bottom: 50px; left: 50%; transform: translateX(-50%);
            width: 200px; height: 20px; background: #555; border-radius: 4px;
        }
        .stand-pole {
            position: absolute;
            bottom: 70px; left: 50%; transform: translateX(-50%);
            width: 15px; height: 250px; background: linear-gradient(90deg, #777, #999, #777);
        }
        .stand-joint {
            position: absolute;
            bottom: 300px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 20px; background: #333; border-radius: 50%;
            z-index: 5;
        }

        /* Beam */
        .beam-container {
            position: absolute;
            bottom: 310px; /* Pivots at the joint */
            left: 50%;
            width: 700px;
            height: 40px;
            margin-left: -350px;
            transform-origin: center center;
            transition: transform 1s cubic-bezier(0.2, 1, 0.3, 1);
        }

        .beam {
            width: 100%;
            height: 10px;
            background: linear-gradient(to bottom, #d35400, #a04000);
            position: absolute;
            top: 15px; /* Center vertical */
            border-radius: 5px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }

        /* Ruler Marks */
        .mark {
            position: absolute;
            top: 0;
            width: 1px;
            height: 100%;
            background: rgba(255,255,255,0.5);
        }
        .mark-label {
            position: absolute;
            top: -20px;
            font-size: 10px;
            font-weight: bold;
            color: #333;
            transform: translateX(-50%);
            pointer-events: none;
        }
        
        /* Hooks/Positions */
        .hook-zone {
            position: absolute;
            top: 25px; /* Below beam */
            width: 20px;
            height: 100px; /* Drop zone */
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Weight on beam */
        .hanging-weight {
            width: 30px;
            height: 40px;
            background: linear-gradient(to right, #f1c40f, #f39c12, #f1c40f);
            border: 1px solid #b7950b;
            border-radius: 3px;
            margin-top: -5px; /* Overlap for hooking */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 9px;
            font-weight: bold;
            position: relative;
            z-index: 10;
            cursor: pointer;
        }
        .hanging-weight::before {
            content: '';
            position: absolute;
            top: -8px; left: 10px;
            width: 8px; height: 8px;
            border: 2px solid #555;
            border-radius: 50%;
        }

        /* TABLE SECTION */
        .lab-report {
            height: 250px;
            background: white;
            border-top: 3px solid #34495e;
            padding: 15px;
            overflow-y: auto;
        }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
        th { background: #f2f2f2; }
        input { width: 90%; border: 1px solid #ddd; padding: 3px; text-align: center; }
        input:focus { border-color: #3498db; outline: none; }
        
        .correct { background: #d4edda; }
        .incorrect { background: #f8d7da; }

    </style>
</head>
<body>

<header>
    <div class="header-left">
        <h1 id="main-title">Лабораторная работа №8: Определение условия равновесия рычага</h1>
        <div class="goal" id="main-goal">Цель: научиться экспериментально определять условия равновесия рычага.</div>
    </div>
    <button class="lang-switch" onclick="toggleLang()">RU / KZ</button>
</header>

<div class="workspace">
    <div class="sidebar">
        <div class="control-group">
            <h3 id="equipment-title" style="margin-top: 0;">Оборудование</h3>
            <p id="equipment-desc" style="font-size: 0.9rem;">Груз массой <strong>100 г</strong>.</p>
            <div class="weight-source">
                <div class="weight-obj" draggable="true" id="sourceWeight">100г</div>
            </div>
            <p id="equipment-hint" style="font-size: 0.8rem; color: #777;">Перетащите грузы на рычаг.</p>
        </div>

        <div class="control-group">
            <h3 id="state-title" style="margin-top: 0;">Состояние</h3>
            <div id="balanceStatus" style="font-weight: bold; text-align: center; color: green;">РАВНОВЕСИЕ</div>
            <div style="font-size:0.8rem; margin-top:5px; text-align: center;">
                g ≈ 9.8 м/с²<br>
                100 г = 0.1 кг ≈ 0.98 Н
            </div>
        </div>

        <button id="btn-reset" onclick="resetSim()" style="padding:10px; background:#e74c3c; color:white; border:none; border-radius:4px; cursor:pointer; font-weight: bold;">Снять все грузы</button>
    </div>

    <div class="sim-area" ondragover="allowDrop(event)" ondrop="drop(event)">
        <div class="lab-setup">
            <div class="stand-base"></div>
            <div class="stand-pole"></div>
            <div class="stand-joint"></div>

            <div class="beam-container" id="beamContainer">
                <div class="beam" id="beam"></div>
            </div>
        </div>
    </div>
</div>

<div class="lab-report">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h3 id="table-title" style="margin:0;">Таблица результатов</h3>
        <button id="btn-check" onclick="checkResults()" style="padding:8px 20px; background:#2980b9; color:white; border:none; border-radius:4px; cursor:pointer; font-weight: bold;">Проверить вычисления</button>
    </div>
    
    <table id="dataTable">
        <thead>
            <tr>
                <th id="th-left" colspan="4">Слева от оси</th>
                <th id="th-right" colspan="4">Справа от оси</th>
            </tr>
            <tr>
                <th id="th-m1">Масса<br>m1, г</th>
                <th id="th-l1">Плечо<br>l1, см</th>
                <th id="th-f1">Сила<br>F1, Н</th>
                <th id="th-mom1">Момент<br>M1, Н·м</th>
                <th id="th-m2">Масса<br>m2, г</th>
                <th id="th-l2">Плечо<br>l2, см</th>
                <th id="th-f2">Сила<br>F2, Н</th>
                <th id="th-mom2">Момент<br>M2, Н·м</th>
            </tr>
        </thead>
        <tbody>
            <tr id="row1">
                <td><input type="number" id="r1_m1" placeholder="0"></td>
                <td><input type="number" id="r1_l1" placeholder="0"></td>
                <td><input type="number" id="r1_f1" placeholder="0.0"></td>
                <td><input type="number" id="r1_mom1" placeholder="0.0"></td>
                <td><input type="number" id="r1_m2" placeholder="0"></td>
                <td><input type="number" id="r1_l2" placeholder="0"></td>
                <td><input type="number" id="r1_f2" placeholder="0.0"></td>
                <td><input type="number" id="r1_mom2" placeholder="0.0"></td>
            </tr>
            <tr id="row2">
                <td><input type="number" id="r2_m1" placeholder="0"></td>
                <td><input type="number" id="r2_l1" placeholder="0"></td>
                <td><input type="number" id="r2_f1" placeholder="0.0"></td>
                <td><input type="number" id="r2_mom1" placeholder="0.0"></td>
                <td><input type="number" id="r2_m2" placeholder="0"></td>
                <td><input type="number" id="r2_l2" placeholder="0"></td>
                <td><input type="number" id="r2_f2" placeholder="0.0"></td>
                <td><input type="number" id="r2_mom2" placeholder="0.0"></td>
            </tr>
            <tr id="row3">
                <td><input type="number" id="r3_m1" placeholder="0"></td>
                <td><input type="number" id="r3_l1" placeholder="0"></td>
                <td><input type="number" id="r3_f1" placeholder="0.0"></td>
                <td><input type="number" id="r3_mom1" placeholder="0.0"></td>
                <td><input type="number" id="r3_m2" placeholder="0"></td>
                <td><input type="number" id="r3_l2" placeholder="0"></td>
                <td><input type="number" id="r3_f2" placeholder="0.0"></td>
                <td><input type="number" id="r3_mom2" placeholder="0.0"></td>
            </tr>
        </tbody>
    </table>
    <p id="hints-box" style="font-size:0.8rem; color:#666; margin-top: 10px;">
        Указания:<br>
        1. F = m(кг) · g, где g ≈ 9.8 Н/кг.<br>
        2. M = F · l(м). Обратите внимание: плечо в таблице в см, в формуле момента — в метрах!<br>
        3. Установите равновесие, занесите данные, затем нажмите "Проверить вычисления".
    </p>
</div>

<script>
    // === ЛОКАЛИЗАЦИЯ ===
    const dict = {
        ru: {
            title: "Лаб. работа №8: Условия равновесия рычага",
            h1: "Лабораторная работа №8: Определение условия равновесия рычага",
            goal: "Цель: научиться экспериментально определять условия равновесия рычага.",
            equipTitle: "Оборудование",
            equipDesc: "Груз массой <strong>100 г</strong>.",
            equipHint: "Перетащите грузы на рычаг.",
            stateTitle: "Состояние",
            btnReset: "Снять все грузы",
            tableTitle: "Таблица результатов",
            btnCheck: "Проверить вычисления",
            thLeft: "Слева от оси",
            thRight: "Справа от оси",
            thM1: "Масса<br>m1, г",
            thL1: "Плечо<br>l1, см",
            thF1: "Сила<br>F1, Н",
            thMom1: "Момент<br>M1, Н·м",
            thM2: "Масса<br>m2, г",
            thL2: "Плечо<br>l2, см",
            thF2: "Сила<br>F2, Н",
            thMom2: "Момент<br>M2, Н·м",
            hints: "Указания:<br>1. F = m(кг) · g, где g ≈ 9.8 Н/кг.<br>2. M = F · l(м). Обратите внимание: плечо в таблице в см, в формуле момента — в метрах!<br>3. Установите равновесие, занесите данные, затем нажмите «Проверить вычисления».",
            bal: "РАВНОВЕСИЕ",
            leftOver: "ПЕРЕВЕС СЛЕВА",
            rightOver: "ПЕРЕВЕС СПРАВА",
            weightUnit: "г"
        },
        kz: {
            title: "Зертхана №8: Иіндіктің тепе-теңдік шарттары",
            h1: "Зертханалық жұмыс №8: Иіндіктің тепе-теңдік шартын анықтау",
            goal: "Мақсаты: иіндіктің тепе-теңдік шарттарын тәжірибе жүзінде анықтауды үйрену.",
            equipTitle: "Құрал-жабдықтар",
            equipDesc: "Массасы <strong>100 г</strong> жүк.",
            equipHint: "Жүктерді иіндікке сүйреңіз.",
            stateTitle: "Күйі",
            btnReset: "Барлық жүктерді алып тастау",
            tableTitle: "Нәтижелер кестесі",
            btnCheck: "Есептеулерді тексеру",
            thLeft: "Осьтің сол жағы",
            thRight: "Осьтің оң жағы",
            thM1: "Масса<br>m1, г",
            thL1: "Иін<br>l1, см",
            thF1: "Күш<br>F1, Н",
            thMom1: "Момент<br>M1, Н·м",
            thM2: "Масса<br>m2, г",
            thL2: "Иін<br>l2, см",
            thF2: "Күш<br>F2, Н",
            thMom2: "Момент<br>M2, Н·м",
            hints: "Нұсқаулар:<br>1. F = m(кг) · g, мұндағы g ≈ 9.8 Н/кг.<br>2. M = F · l(м). Назар аударыңыз: кестедегі иін см-мен, ал момент формуласында — метрмен!<br>3. Тепе-теңдікті орнатыңыз, деректерді енгізіңіз, содан кейін «Есептеулерді тексеру» түймесін басыңыз.",
            bal: "ТЕПЕ-ТЕҢДІК",
            leftOver: "СОЛ ЖАҚ БАСЫМ",
            rightOver: "ОҢ ЖАҚ БАСЫМ",
            weightUnit: "г"
        }
    };

    let currentLang = 'ru';

    function toggleLang() {
        currentLang = currentLang === 'ru' ? 'kz' : 'ru';
        applyTranslations();
        calcPhysics(); // Update balance text
        renderWeights(); // Update weight text
    }

    function applyTranslations() {
        const t = dict[currentLang];
        document.getElementById('page-title').innerText = t.title;
        document.getElementById('main-title').innerText = t.h1;
        document.getElementById('main-goal').innerHTML = t.goal;
        
        document.getElementById('equipment-title').innerText = t.equipTitle;
        document.getElementById('equipment-desc').innerHTML = t.equipDesc;
        document.getElementById('equipment-hint').innerText = t.equipHint;
        
        document.getElementById('sourceWeight').innerText = "100" + t.weightUnit;
        
        document.getElementById('state-title').innerText = t.stateTitle;
        document.getElementById('btn-reset').innerText = t.btnReset;
        
        document.getElementById('table-title').innerText = t.tableTitle;
        document.getElementById('btn-check').innerText = t.btnCheck;
        
        document.getElementById('th-left').innerText = t.thLeft;
        document.getElementById('th-right').innerText = t.thRight;
        document.getElementById('th-m1').innerHTML = t.thM1;
        document.getElementById('th-l1').innerHTML = t.thL1;
        document.getElementById('th-f1').innerHTML = t.thF1;
        document.getElementById('th-mom1').innerHTML = t.thMom1;
        document.getElementById('th-m2').innerHTML = t.thM2;
        document.getElementById('th-l2').innerHTML = t.thL2;
        document.getElementById('th-f2').innerHTML = t.thF2;
        document.getElementById('th-mom2').innerHTML = t.thMom2;
        
        document.getElementById('hints-box').innerHTML = t.hints;
    }

    // === CONFIG ===
    const G_CONST = 9.8;
    const WEIGHT_MASS_G = 100; // 100g per weight
    const RULER_MAX_CM = 30; // +/- 30cm
    const PX_PER_CM = 10; // visual scale: 700px width total, 350px half. 30cm * 10 = 300px. Fits.

    // State
    // format: { id, mass: 100, pos: -10, stackIndex: 0 }
    let weights = []; 
    let dragSrc = null;

    // === INIT ===
    function init() {
        createRuler();
        setupDrag();
        calcPhysics();
        applyTranslations();
    }

    function createRuler() {
        const container = document.getElementById('beamContainer');
        const centerPx = 350; // container is 700px wide

        for(let i = -30; i <= 30; i+=2) { // Step 2cm for visual clarity
            if (i === 0) continue;
            
            const leftPos = centerPx + (i * PX_PER_CM);
            
            // Mark
            const mark = document.createElement('div');
            mark.className = 'mark';
            mark.style.left = leftPos + 'px';
            mark.style.height = (i % 10 === 0) ? '100%' : '50%';
            mark.style.top = (i % 10 === 0) ? '0' : '5px';
            container.appendChild(mark);

            // Label
            if(Math.abs(i) % 10 === 0) {
                const lbl = document.createElement('div');
                lbl.className = 'mark-label';
                lbl.innerText = Math.abs(i);
                lbl.style.left = leftPos + 'px';
                container.appendChild(lbl);
            }

            // Drop Zone (Invisible interaction layer)
            const zone = document.createElement('div');
            zone.className = 'hook-zone';
            zone.style.left = leftPos + 'px';
            zone.dataset.pos = i;
            zone.id = `zone_${i}`;
            container.appendChild(zone);
        }
    }

    function setupDrag() {
        const src = document.getElementById('sourceWeight');
        src.addEventListener('dragstart', (e) => {
            dragSrc = { type: 'new' };
        });
    }

    function allowDrop(ev) { ev.preventDefault(); }

    function drop(ev) {
        ev.preventDefault();
        
        // Find closest zone
        // Mouse X relative to beam container
        const beamRect = document.getElementById('beamContainer').getBoundingClientRect();
        
        let target = ev.target;
        
        // Traverse up to find hook-zone or weight
        while(target && !target.classList.contains('hook-zone') && !target.classList.contains('sim-area')) {
            target = target.parentElement;
        }

        if (target && target.classList.contains('hook-zone')) {
            const pos = parseInt(target.dataset.pos);
            addWeight(pos);
        } else {
            // Fallback: Calculate by X coordinate if dropped generally on beam area
            const relX = ev.clientX - beamRect.left;
            const center = beamRect.width / 2;
            const cmRaw = (relX - center) / PX_PER_CM;
            // Round to nearest 2 (since we have hooks every 2cm)
            const cm = Math.round(cmRaw / 2) * 2;
            if(cm !== 0 && Math.abs(cm) <= 30) {
                addWeight(cm);
            }
        }
    }

    function addWeight(pos) {
        // Check existing stack
        const existing = weights.filter(w => w.pos === pos).length;
        
        const newW = {
            id: Date.now(),
            mass: WEIGHT_MASS_G,
            pos: pos,
            stackIndex: existing
        };
        weights.push(newW);
        renderWeights();
        calcPhysics();
    }

    function removeWeight(id) {
        weights = weights.filter(w => w.id !== id);
        renderWeights();
        calcPhysics();
    }

    function renderWeights() {
        // Clear old visual weights
        document.querySelectorAll('.hanging-weight').forEach(el => el.remove());

        // Re-calculate stack indices to ensure no gaps
        const stacks = {}; // pos -> count
        const unitLabel = dict[currentLang].weightUnit;

        weights.forEach(w => {
            if (stacks[w.pos] === undefined) stacks[w.pos] = 0;
            
            // Create DOM
            const zone = document.getElementById(`zone_${w.pos}`);
            if(zone) {
                const div = document.createElement('div');
                div.className = 'hanging-weight';
                div.innerText = '100' + unitLabel;
                div.onclick = (e) => {
                    e.stopPropagation();
                    removeWeight(w.id);
                };
                zone.appendChild(div);
            }
            
            stacks[w.pos]++;
        });
    }

    function calcPhysics() {
        let mLeft = 0; // Torque (Moment)
        let mRight = 0;

        // Moment = Force * Distance
        // F = (m_grams / 1000) * G
        // Dist = cm / 100 (meters)
        // M = (g/1000 * G) * (cm/100) = g * cm * G / 100000

        weights.forEach(w => {
            const massKg = w.mass / 1000;
            const force = massKg * G_CONST;
            const distM = Math.abs(w.pos) / 100;
            const moment = force * distM;

            if (w.pos < 0) {
                mLeft += moment;
            } else {
                mRight += moment;
            }
        });

        // Update Rotation
        const beam = document.getElementById('beamContainer');
        const status = document.getElementById('balanceStatus');
        const t = dict[currentLang];
        
        const diff = mRight - mLeft;
        
        if (Math.abs(diff) < 0.0001) {
            beam.style.transform = 'rotate(0deg)';
            status.innerText = t.bal;
            status.style.color = "green";
        } else if (diff > 0) {
            beam.style.transform = 'rotate(15deg)';
            status.innerText = t.rightOver;
            status.style.color = "#c0392b";
        } else {
            beam.style.transform = 'rotate(-15deg)';
            status.innerText = t.leftOver;
            status.style.color = "#c0392b";
        }
    }

    function resetSim() {
        weights = [];
        renderWeights();
        calcPhysics();
    }

    function checkResults() {
        // Loop through rows
        for(let i=1; i<=3; i++) {
            validateRow(i);
        }
    }

    function validateRow(rowNum) {
        // Get Inputs
        const getVal = (id) => parseFloat(document.getElementById(id).value);
        
        const m1 = getVal(`r${rowNum}_m1`);
        const l1 = getVal(`r${rowNum}_l1`);
        const f1 = getVal(`r${rowNum}_f1`);
        const mom1 = getVal(`r${rowNum}_mom1`);

        const m2 = getVal(`r${rowNum}_m2`);
        const l2 = getVal(`r${rowNum}_l2`);
        const f2 = getVal(`r${rowNum}_f2`);
        const mom2 = getVal(`r${rowNum}_mom2`);

        // Check if row is empty
        if(isNaN(m1)) return;

        // Calc Expected
        // F = m(g) / 1000 * 9.8
        const f1_exp = (m1 / 1000) * G_CONST;
        const f2_exp = (m2 / 1000) * G_CONST;
        
        // M = F * l(cm)/100
        const mom1_exp = f1_exp * (l1 / 100);
        const mom2_exp = f2_exp * (l2 / 100);

        // Validation Helper
        const check = (id, val, expected) => {
            const el = document.getElementById(id);
            // Allow 5% error margin or 0.1 abs error
            const diff = Math.abs(val - expected);
            if (diff < 0.1 || (expected !== 0 && diff/expected < 0.05)) {
                el.className = 'correct';
            } else {
                el.className = 'incorrect';
            }
        };

        check(`r${rowNum}_f1`, f1, f1_exp);
        check(`r${rowNum}_f2`, f2, f2_exp);
        check(`r${rowNum}_mom1`, mom1, mom1_exp);
        check(`r${rowNum}_mom2`, mom2, mom2_exp);
    }

    // Start
    init();

</script>
</body>
</html>