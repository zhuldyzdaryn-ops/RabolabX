<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лаб. работа №14: Коэффициент трения</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { 
            --primary: #2c3e50; 
            --accent: #c0392b; 
            --bg: #fdfefe; 
            --panel: #ffffff; 
            --success: #27ae60; 
            --text: #34495e; 
            --border: #bdc3c7;
        }

        /* Добавлена прокрутка для экранов меньше 750px в высоту, чтобы избежать перекрытий */
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            overflow-y: auto; 
        }
        
        /* HEADER & LANG SWITCH */
        header {
            background-color: var(--primary);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .header-content h1 { margin: 0; font-size: 1.3rem; color: #fff; }
        .theory-mini { font-size: 0.85rem; opacity: 0.9; margin-top: 5px; }

        .lang-switch {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .lang-switch:hover { background: rgba(255,255,255,0.3); }

        /* FLEXBOX LAYOUT */
        .main-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            flex: 1;
            background: #ecf0f1;
            min-height: 650px; /* Защита от схлопывания сетки */
        }

        .row-top {
            display: flex;
            gap: 20px;
            flex: 1.2;
            min-height: 0; /* Важно для работы flexbox внутри */
        }

        .row-bottom {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 250px;
        }

        .card { 
            background: var(--panel); 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            display: flex;
            flex-direction: column;
            border: 1px solid #dfe6e9;
        }
        
        h2, h3 { color: var(--primary); margin-top: 0; font-size: 1.1rem; margin-bottom: 12px; }

        /* 1. ПАНЕЛЬ УПРАВЛЕНИЯ */
        .controls-card { width: 340px; flex-shrink: 0; overflow-y: auto; }
        .control-group { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 12px; }
        .control-group:last-child { border: none; margin-bottom: 0; padding-bottom: 0; }
        label { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem;}
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--accent); }
        select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #bdc3c7; font-size: 0.9rem;}
        .val-display { color: var(--accent); font-weight: bold; font-family: monospace; font-size: 1.1em; }
        
        .stopwatch {
            background: #2c3e50; color: #f1c40f; font-family: 'Courier New', monospace; 
            font-size: 2rem; text-align: center; padding: 10px; border-radius: 6px; margin: 15px 0;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .btn { border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; margin-top: 8px; color: white; font-size: 0.95rem; }
        .btn-start { background: var(--success); }
        .btn-start:disabled { background: #bdc3c7; cursor: not-allowed; }
        .btn-start:hover:not(:disabled) { background: #219150; }
        .btn-record { background: #2980b9; }
        .btn-record:disabled { background: #bdc3c7; cursor: not-allowed; }
        .btn-reset { background: #95a5a6; }

        /* 2. СИМУЛЯЦИЯ */
        .sim-card { flex: 1; padding: 0; overflow: hidden; }
        .svg-container { flex: 1; min-height: 0; display: flex; justify-content: center; align-items: flex-start; background: #fff;}
        
        /* SVG CSS */
        .rail { stroke: #7f8c8d; stroke-width: 14; stroke-linecap: round; }
        .block { fill: #e67e22; stroke: #d35400; stroke-width: 2; }
        .sensor { fill: #f1c40f; stroke: #f39c12; }
        .floor { stroke: #2c3e50; stroke-width: 3; }
        .stand { fill: #bdc3c7; stroke: #7f8c8d; stroke-width: 1; }
        .arrow { stroke-width: 2; marker-end: url(#arrowhead); }

        /* 3. ЖУРНАЛ (НИЗ ЛЕВО) */
        .journal-card { flex: 1; padding: 0; overflow: hidden; }
        .j-header { padding: 15px; background: #f8f9fa; font-weight: bold; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee;}
        .table-wrap { overflow-y: auto; flex: 1; padding: 0 15px 15px 15px;}
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th, td { border: 1px solid #bdc3c7; padding: 10px; text-align: center; }
        th { background-color: #ecf0f1; position: sticky; top: 0; }

        /* 4. ГРАФИК (НИЗ ПРАВО) */
        .chart-card { flex: 1; display: flex; flex-direction: column; }
        .chart-container { flex: 1; position: relative; width: 100%; min-height: 0; }
    </style>
</head>
<body>

<header>
    <div class="header-content">
        <h1 data-i18n="title">Лаб. работа №14: Определение коэффициента трения</h1>
        <div class="theory-mini">
            <span data-i18n="goal">Цель: Определить коэффициент трения скольжения бруска по наклонной плоскости.</span> |
            <b>a = g(sinα - μcosα)</b> | 
            <b>μ = (g·sinα - a) / (g·cosα)</b>
        </div>
    </div>
    <button class="lang-switch" onclick="toggleLang()">RU / KZ</button>
</header>

<div class="main-wrapper">
    
    <div class="row-top">
        <div class="card controls-card">
            <h2 data-i18n="h_settings">Настройки</h2>

            <div class="control-group">
                <label data-i18n="lbl_mat">Материалы (пара трения):</label>
                <select id="material-select" onchange="changeMaterial()">
                    <option value="0.25" data-i18n="opt_1">Дерево по дереву (μ ≈ 0.25)</option>
                    <option value="0.40" data-i18n="opt_2">Пластик по пластику (μ ≈ 0.40)</option>
                    <option value="0.60" data-i18n="opt_3">Резина по металлу (μ ≈ 0.60)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label><span data-i18n="lbl_angle">Угол наклона (α):</span> <span class="val-display"><span id="angle-val">30</span>&deg;</span></label>
                <input type="range" id="angle-input" min="0" max="60" value="30" step="1" oninput="updateSetup()">
                <small style="color: #e74c3c; display: none; margin-top:5px; font-weight:bold;" id="stuck-msg" data-i18n="msg_stuck">Брусок не скользит!</small>
            </div>

            <div class="control-group">
                <label><span data-i18n="lbl_s">Путь S (м):</span> <span class="val-display"><span id="s-val">0.50</span> м</span></label>
                <input type="range" id="s-input" min="0.3" max="0.9" value="0.50" step="0.05" oninput="updateSetup()">
            </div>
            
            <div class="stopwatch"><span id="timer-display">0.000</span></div>

            <button class="btn btn-start" id="btn-start" onclick="startSimulation()" data-i18n="btn_start">▶ ЗАПУСК</button>
            <button class="btn btn-record" id="btn-record" onclick="recordData()" disabled data-i18n="btn_record">⬇ ЗАПИСАТЬ</button>
            <button class="btn btn-reset" onclick="resetSim()" data-i18n="btn_reset">↺ СБРОС (Наверх)</button>
        </div>

        <div class="card sim-card">
            <div class="svg-container">
                <svg id="sim-svg" viewBox="0 0 750 500" preserveAspectRatio="xMidYMin meet" style="width: 100%; height: 100%;">
                    <defs>
                        <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                            <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#f0f0f0" stroke-width="1"/>
                        </pattern>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <path d="M0,0 L10,3.5 L0,7 Z" fill="#2c3e50" />
                        </marker>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)" />

                    <line x1="20" y1="350" x2="730" y2="350" class="floor" />

                    <g id="bench-group" transform="translate(100, 350)">
                        <line x1="0" y1="0" x2="500" y2="0" class="rail" />
                        <g id="ruler-group"></g>

                        <g transform="translate(500, 0)">
                            <rect x="-5" y="-18" width="10" height="15" class="sensor" />
                            <text x="0" y="25" font-size="12" fill="#7f8c8d" text-anchor="middle">0</text>
                        </g>

                        <g id="sensor2-group">
                            <rect x="-5" y="-18" width="10" height="15" class="sensor" />
                            <line x1="0" y1="-18" x2="0" y2="-45" stroke="#f39c12" stroke-dasharray="4" />
                            <text x="0" y="25" font-size="12" fill="#d35400" text-anchor="middle" font-weight="bold" id="sensor2-text">50см</text>
                        </g>

                        <g id="block-group" transform="translate(500, 0)">
                            <rect x="-25" y="-22" width="50" height="20" class="block" rx="2" />
                            
                            <line x1="0" y1="-22" x2="0" y2="-60" stroke="#2c3e50" class="arrow" opacity="0.6"/>
                            <text x="5" y="-55" fill="#2c3e50" font-size="12">N</text>

                            <g id="p-vector-group" transform="translate(0, -10)">
                                <line x1="0" y1="0" x2="0" y2="60" stroke="#2c3e50" class="arrow" opacity="0.6"/>
                                <text x="5" y="55" fill="#2c3e50" font-size="12" font-weight="bold">mg</text>
                            </g>
                        </g>
                    </g>
                    
                    <g id="stand-group" transform="translate(600, 0)">
                        <rect x="-5" y="200" width="10" height="250" class="stand" id="stand-pole-rect" />
                        <rect x="-20" y="345" width="40" height="5" class="stand" />
                        <text x="15" y="325" font-size="14" fill="#7f8c8d" id="h-label" text-anchor="start">h</text>
                    </g>

                    <text x="160" y="340" font-size="14" fill="#7f8c8d">&alpha;</text>
                    <path d="M 160,350 A 60,60 0 0 0 160,290" stroke="#bdc3c7" fill="none" id="angle-arc"/>
                </svg>
            </div>
            <div style="padding: 10px 20px; background: #f8f9fa; border-top: 1px solid #ddd; font-size:0.95rem;">
                <strong data-i18n="stat_lbl">Статус:</strong> <span id="status-text">Выберите материал и угол.</span>
            </div>
        </div>
    </div>

    <div class="row-bottom">
        <div class="card journal-card">
            <div class="j-header">
                <span data-i18n="j_title">Журнал измерений</span>
                <button class="btn btn-reset" style="width: auto; padding: 6px 15px; margin:0;" onclick="clearTable()" data-i18n="btn_clear">Очистить</button>
            </div>
            <div class="table-wrap">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th data-i18n="th_num">№</th>
                            <th data-i18n="th_angle">Угол (град)</th>
                            <th data-i18n="th_s">Путь S (м)</th>
                            <th data-i18n="th_t">Время t (с)</th>
                            <th data-i18n="th_a">a (м/с²)</th>
                            <th data-i18n="th_mu">μ (расч)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="card chart-card">
            <h3 data-i18n="chart_title" style="margin-bottom: 10px;">Зависимость ускорения от угла</h3>
            <div class="chart-container">
                <canvas id="chartAa"></canvas>
            </div>
        </div>
    </div>

</div>

<script>
    // === КОНСТАНТЫ ===
    const g = 9.81;
    const PIXELS_PER_METER = 500; 
    const RAIL_LENGTH_PX = 500;
    const PIVOT_X = 100;
    const PIVOT_Y = 350; 
    const RAIL_START_LOCAL = 500; 

    // Состояние
    let angleDeg = 30; 
    let S = 0.5;
    let mu = 0.25; 
    
    let measuredTime = 0;
    let accResult = 0;
    let muResult = 0;

    let isRunning = false;
    let animFrame = null;
    let currentLang = 'ru';

    // === ЛОКАЛИЗАЦИЯ ===
    const i18n = {
        ru: {
            title: "Лаб. работа №14: Определение коэффициента трения",
            goal: "Цель: Определить коэффициент трения скольжения бруска по наклонной плоскости.",
            h_settings: "Настройки",
            lbl_mat: "Материалы (пара трения):",
            opt_1: "Дерево по дереву (μ ≈ 0.25)",
            opt_2: "Пластик по пластику (μ ≈ 0.40)",
            opt_3: "Резина по металлу (μ ≈ 0.60)",
            lbl_angle: "Угол наклона (α):",
            msg_stuck: "Брусок не скользит!",
            lbl_s: "Путь S (м):",
            btn_start: "▶ ЗАПУСК",
            btn_record: "⬇ ЗАПИСАТЬ",
            btn_reset: "↺ СБРОС (Наверх)",
            stat_lbl: "Статус:",
            stat_init: "Выберите материал и угол.",
            stat_stuck: "Угол мал: сила трения удерживает брусок.",
            stat_ready: "Готов к запуску.",
            stat_move: "Движение...",
            stat_finish: "Финиш. Запишите данные.",
            stat_rec: "Записано. Попробуйте другой угол.",
            stat_no_move: "Брусок не движется (Fтр > Fтяж). Увеличьте угол.",
            j_title: "Журнал измерений",
            btn_clear: "Очистить",
            th_num: "№",
            th_angle: "Угол (град)",
            th_s: "Путь S (м)",
            th_t: "Время t (с)",
            th_a: "a (м/с²)",
            th_mu: "μ (расч)",
            chart_title: "Зависимость ускорения от угла",
            chart_ds: "Эксперимент (Угол, a)",
            chart_x: "Угол (градусы)",
            chart_y: "Ускорение (м/с²)"
        },
        kz: {
            title: "№14 Зертханалық жұмыс: Үйкеліс коэффициентін анықтау",
            goal: "Мақсаты: Көлбеу жазықтықта білеушенің сырғанау үйкеліс коэффициентін анықтау.",
            h_settings: "Параметрлер",
            lbl_mat: "Материалдар (үйкеліс жұбы):",
            opt_1: "Ағаш бойынша ағаш (μ ≈ 0.25)",
            opt_2: "Пластик бойынша пластик (μ ≈ 0.40)",
            opt_3: "Металл бойынша резеңке (μ ≈ 0.60)",
            lbl_angle: "Көлбеу бұрышы (α):",
            msg_stuck: "Білеуше сырғанамайды!",
            lbl_s: "Жол S (м):",
            btn_start: "▶ ІСКЕ ҚОСУ",
            btn_record: "⬇ ЖАЗУ",
            btn_reset: "↺ ҚАЙТАРУ (Жоғарыға)",
            stat_lbl: "Күйі:",
            stat_init: "Материал мен бұрышты таңдаңыз.",
            stat_stuck: "Бұрыш аз: үйкеліс күші білеушені ұстап тұр.",
            stat_ready: "Іске қосуға дайын.",
            stat_move: "Қозғалыс...",
            stat_finish: "Мәре. Деректерді жазыңыз.",
            stat_rec: "Жазылды. Басқа бұрышты көріңіз.",
            stat_no_move: "Білеуше қозғалмайды (Fүйк > Fауыр). Бұрышты үлкейтіңіз.",
            j_title: "Өлшеу журналы",
            btn_clear: "Тазалау",
            th_num: "№",
            th_angle: "Бұрыш (град)",
            th_s: "Жол S (м)",
            th_t: "Уақыт t (с)",
            th_a: "a (м/с²)",
            th_mu: "μ (есепт)",
            chart_title: "Үдеудің бұрышқа тәуелділігі",
            chart_ds: "Тәжірибе (Бұрыш, a)",
            chart_x: "Бұрыш (градус)",
            chart_y: "Үдеу (м/с²)"
        }
    };

    let currentStateLabel = 'stat_init';

    function toggleLang() {
        currentLang = currentLang === 'ru' ? 'kz' : 'ru';
        
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (i18n[currentLang][key]) {
                el.innerText = i18n[currentLang][key];
            }
        });

        updateStateText(currentStateLabel);
        updateChartLang();
    }

    function updateStateText(stateKey) {
        currentStateLabel = stateKey;
        document.getElementById('status-text').innerText = i18n[currentLang][stateKey];
    }

    // UI элементы
    const ui = {
        angleInput: document.getElementById('angle-input'),
        sInput: document.getElementById('s-input'),
        matSelect: document.getElementById('material-select'),
        angleVal: document.getElementById('angle-val'),
        sVal: document.getElementById('s-val'),
        timer: document.getElementById('timer-display'),
        stuckMsg: document.getElementById('stuck-msg'),
        simSvg: document.getElementById('sim-svg'),
        
        benchGroup: document.getElementById('bench-group'),
        sensor2Group: document.getElementById('sensor2-group'),
        sensor2Text: document.getElementById('sensor2-text'),
        blockGroup: document.getElementById('block-group'),
        rulerGroup: document.getElementById('ruler-group'),
        
        standGroup: document.getElementById('stand-group'),
        standPoleRect: document.getElementById('stand-pole-rect'),
        angleArc: document.getElementById('angle-arc'),
        pVectorGroup: document.getElementById('p-vector-group'),
        
        btnStart: document.getElementById('btn-start'),
        btnRecord: document.getElementById('btn-record'),
        tableBody: document.querySelector('#data-table tbody')
    };

    // Chart.js
    const ctx = document.getElementById('chartAa').getContext('2d');
    const chartAa = new Chart(ctx, {
        type: 'scatter',
        data: { datasets: [{
            label: i18n[currentLang].chart_ds,
            data: [],
            backgroundColor: '#c0392b',
            pointRadius: 6
        }] },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { type: 'linear', position: 'bottom', title: {display:true, text: i18n[currentLang].chart_x}, min: 0, max: 60 },
                y: { title: {display:true, text: i18n[currentLang].chart_y}, min: 0 }
            }
        }
    });

    function updateChartLang() {
        chartAa.data.datasets[0].label = i18n[currentLang].chart_ds;
        chartAa.options.scales.x.title.text = i18n[currentLang].chart_x;
        chartAa.options.scales.y.title.text = i18n[currentLang].chart_y;
        chartAa.update();
    }

    // === LOGIC ===

    function changeMaterial() {
        mu = parseFloat(ui.matSelect.value);
        updateSetup();
    }

    function initRuler() {
        let svgHtml = '';
        for (let i = 0; i <= 10; i++) {
            const px = RAIL_START_LOCAL - (i * 0.1 * PIXELS_PER_METER);
            let h = 10;
            if (i % 5 === 0) h = 15;
            svgHtml += `<line x1="${px}" y1="0" x2="${px}" y2="${h}" stroke="#95a5a6" stroke-width="1" />`;
            svgHtml += `<text x="${px}" y="${h+12}" font-size="10" fill="#7f8c8d" text-anchor="middle">${i*10}</text>`;
        }
        ui.rulerGroup.innerHTML = svgHtml;
    }

    function updateSetup() {
        if (isRunning) return;

        angleDeg = parseInt(ui.angleInput.value);
        S = parseFloat(ui.sInput.value);

        ui.angleVal.innerText = angleDeg;
        ui.sVal.innerText = S.toFixed(2);
        ui.sensor2Text.textContent = Math.round(S*100) + 'см';

        const angleRad = angleDeg * Math.PI / 180;

        ui.benchGroup.setAttribute("transform", `translate(${PIVOT_X}, ${PIVOT_Y}) rotate(${-angleDeg})`);
        ui.pVectorGroup.setAttribute("transform", `translate(0, -10) rotate(${angleDeg}, 0, 0)`);

        const railEndX = PIVOT_X + RAIL_LENGTH_PX * Math.cos(angleRad);
        ui.standGroup.setAttribute("transform", `translate(${railEndX}, 0)`);

        const liftPx = RAIL_LENGTH_PX * Math.sin(angleRad);
        const standTopY = PIVOT_Y - liftPx;
        
        // ДИНАМИЧЕСКИЙ ViewBox ДЛЯ КРУПНОГО МАСШТАБА БЕЗ ПУСТОТ!
        const minY = Math.min(standTopY - 40, PIVOT_Y - 150);
        const height = (PIVOT_Y + 60) - minY;
        ui.simSvg.setAttribute("viewBox", `0 ${minY} 750 ${height}`);

        const poleHeight = 345 - standTopY;
        ui.standPoleRect.setAttribute("y", standTopY);
        ui.standPoleRect.setAttribute("height", poleHeight);
        
        document.getElementById('h-label').setAttribute('y', standTopY + poleHeight/2);

        const arcX = PIVOT_X + 60 * Math.cos(-angleRad);
        const arcY = PIVOT_Y + 60 * Math.sin(-angleRad);
        ui.angleArc.setAttribute("d", `M ${PIVOT_X+60},${PIVOT_Y} A 60,60 0 0 0 ${arcX},${arcY}`);

        const sPx = RAIL_START_LOCAL - (S * PIXELS_PER_METER);
        ui.sensor2Group.setAttribute("transform", `translate(${sPx}, 0)`);
        ui.blockGroup.setAttribute("transform", `translate(${RAIL_START_LOCAL}, 0)`);

        const tanAlpha = Math.tan(angleRad);
        if (tanAlpha <= mu && angleDeg > 0) {
            ui.stuckMsg.style.display = "block";
            updateStateText('stat_stuck');
        } else {
            ui.stuckMsg.style.display = "none";
            updateStateText('stat_ready');
        }

        ui.timer.innerText = "0.000";
        ui.btnRecord.disabled = true;
    }

    function startSimulation() {
        if (isRunning) return;
        
        const angleRad = angleDeg * Math.PI / 180;
        const sinA = Math.sin(angleRad);
        const cosA = Math.cos(angleRad);
        
        let a = g * (sinA - mu * cosA);

        if (a <= 0.001) { 
            updateStateText('stat_no_move');
            return;
        }

        isRunning = true;
        ui.btnStart.disabled = true;
        ui.btnRecord.disabled = true;

        const t_ideal = Math.sqrt((2 * S) / a);
        
        const error = (Math.random() - 0.5) * 0.05;
        measuredTime = t_ideal + error;
        if (measuredTime < 0.01) measuredTime = t_ideal;
        
        accResult = (2 * S) / (measuredTime * measuredTime);
        muResult = (g * sinA - accResult) / (g * cosA);

        let startTime = null;
        const duration = measuredTime * 1000;
        const distPx = S * PIXELS_PER_METER;

        updateStateText('stat_move');

        function animate(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;
            const t_curr = Math.min(elapsed / 1000, measuredTime);

            const a_vis = (2 * distPx) / (measuredTime * measuredTime);
            const deltaX = 0.5 * a_vis * t_curr * t_curr;

            const currentPos = RAIL_START_LOCAL - deltaX;

            ui.blockGroup.setAttribute("transform", `translate(${currentPos}, 0)`);
            ui.timer.innerText = t_curr.toFixed(3);

            if (elapsed < duration) {
                animFrame = requestAnimationFrame(animate);
            } else {
                finishRun();
            }
        }
        animFrame = requestAnimationFrame(animate);
    }

    function finishRun() {
        isRunning = false;
        ui.btnStart.disabled = false;
        ui.btnRecord.disabled = false;
        
        const finalPos = RAIL_START_LOCAL - (S * PIXELS_PER_METER);
        ui.blockGroup.setAttribute("transform", `translate(${finalPos}, 0)`);
        ui.timer.innerText = measuredTime.toFixed(3);
        updateStateText('stat_finish');
    }

    function resetSim() {
        if(animFrame) cancelAnimationFrame(animFrame);
        isRunning = false;
        ui.btnStart.disabled = false;
        updateSetup();
    }

    function recordData() {
        ui.btnRecord.disabled = true;
        
        const tbody = ui.tableBody;
        const row = document.createElement('tr');
        const num = tbody.children.length + 1;
        
        row.innerHTML = `
            <td>${num}</td>
            <td>${angleDeg}</td>
            <td>${S.toFixed(2)}</td>
            <td>${measuredTime.toFixed(3)}</td>
            <td>${accResult.toFixed(2)}</td>
            <td><b>${muResult.toFixed(2)}</b></td>
        `;
        tbody.appendChild(row);

        const wrapper = document.querySelector('.table-wrap');
        wrapper.scrollTop = wrapper.scrollHeight;

        chartAa.data.datasets[0].data.push({x: angleDeg, y: accResult});
        chartAa.data.datasets[0].data.sort((a,b) => a.x - b.x); 
        chartAa.update();
        
        updateStateText('stat_rec');
    }

    function clearTable() {
        ui.tableBody.innerHTML = '';
        chartAa.data.datasets[0].data = [];
        chartAa.update();
        updateStateText('stat_init');
    }

    initRuler();
    updateSetup();

</script>
</body>
</html>