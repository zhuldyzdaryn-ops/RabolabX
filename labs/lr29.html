<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лаб. работа №10: КПД Наклонной плоскости</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --wood: #d35400;
            --metal: #95a5a6;
            --bg: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--primary);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* HEADER */
        header {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-left {
            display: flex;
            flex-direction: column;
        }
        h1 { margin: 0; font-size: 1.2rem; }
        .goal { font-size: 0.9rem; font-style: italic; opacity: 0.9; margin-top: 5px; border-left: 3px solid #f1c40f; padding-left: 10px; }

        .lang-switch {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            white-space: nowrap;
            margin-left: 20px;
        }
        .lang-switch:hover { background: rgba(255,255,255,0.3); }

        /* WORKSPACE */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 320px;
            background: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            z-index: 10;
        }

        .control-group {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }

        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input[type=range] { width: 100%; cursor: pointer; }
        
        .readout {
            font-family: monospace;
            font-size: 1.2rem;
            color: var(--accent);
            text-align: right;
            font-weight: bold;
        }

        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: 0.2s;
            margin-top: 5px;
        }
        .btn-pull { background: #e67e22; }
        .btn-pull:hover { background: #d35400; }
        .btn-record { background: var(--accent); }
        .btn-record:hover { background: #219150; }
        .btn-record:disabled { background: #bdc3c7; cursor: not-allowed; }
        .btn-check { background: #2980b9; width: auto; padding: 5px 15px; }

        /* SIMULATION AREA */
        .sim-area {
            flex: 1;
            position: relative;
            background: radial-gradient(circle, #fff, #bdc3c7);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* SVG & Physics Objects */
        svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .ramp {
            fill: #e67e22;
            stroke: #d35400;
            stroke-width: 2;
        }

        .block {
            fill: #34495e;
            stroke: #2c3e50;
        }

        .string {
            stroke: #333;
            stroke-width: 2;
        }

        .dynamometer {
            fill: #f1c40f;
            stroke: #f39c12;
            stroke-width: 1;
        }

        .measure-line {
            stroke: #7f8c8d;
            stroke-width: 1;
            stroke-dasharray: 4 2;
        }
        .measure-text {
            font-size: 12px;
            fill: #555;
            font-family: monospace;
        }

        /* TABLE */
        .report-panel {
            height: 250px;
            background: white;
            border-top: 3px solid var(--primary);
            padding: 15px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
        th { background: #f2f2f2; position: sticky; top: 0;}
        
        .user-input {
            width: 80px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: center;
        }
        .user-input.correct { background: #d4edda; border-color: #28a745; }
        .user-input.incorrect { background: #f8d7da; border-color: #dc3545; }

    </style>
</head>
<body>

<header>
    <div class="header-left">
        <h1 id="main-title">Лаб. работа №10: Определение КПД наклонной плоскости</h1>
        <div id="main-goal" class="goal">Цель: убедиться на опыте, что полезная работа меньше полной, и вычислить КПД.</div>
    </div>
    <button class="lang-switch" onclick="toggleLang()">RU / KZ</button>
</header>

<div class="workspace">
    <div class="sidebar">
        <div class="control-group">
            <label id="lbl-params">Параметры установки</label>
            <p style="font-size:0.9rem; margin-bottom:5px;"><span id="lbl-weight">Вес бруска (P):</span> <strong>2.0 Н</strong></p>
            <p style="font-size:0.9rem; margin-bottom:15px;"><span id="lbl-len">Длина доски (l):</span> <strong>1.0 м</strong></p>
            
            <label id="lbl-height">Высота наклона (h):</label>
            <input type="range" id="heightRange" min="0" max="60" value="30" oninput="updateSim()">
            <div class="readout" id="heightReadout">0.30 м</div>
        </div>

        <div class="control-group">
            <label id="lbl-dyna">Динамометр (Сила тяги F):</label>
            <div class="readout" id="forceReadout" style="font-size:1.5rem; color:#d35400;">---</div>
        </div>

        <button class="btn btn-pull" id="btn-pull" onclick="animatePull()">Тянуть брусок</button>
        <button class="btn btn-record" id="btn-record" onclick="recordData()" disabled>Записать измерения</button>
    </div>

    <div class="sim-area">
        <svg id="simSvg" viewBox="0 0 800 400">
            <line x1="0" y1="350" x2="800" y2="350" stroke="#7f8c8d" stroke-width="2" />
            
            <g id="rampGroup">
                <path id="rampPath" class="ramp" d="M 100 350 L 700 350 L 700 150 Z" />
                
                <line id="hLine" class="measure-line" x1="720" y1="350" x2="720" y2="150" />
                <text id="hText" class="measure-text" x="730" y="250">h = 0.3m</text>
                
                <text id="lText" class="measure-text" x="400" y="240" transform="rotate(-15 400 240)">l = 1.0m</text>
            </g>

            <g id="moveGroup">
                <rect id="block" x="-25" y="-20" width="50" height="40" class="block" />
                <text x="-15" y="5" fill="white" font-size="12">P=2H</text>
                
                <line x1="25" y1="0" x2="60" y2="0" class="string" />
                
                <g transform="translate(60, -10)">
                    <rect width="60" height="20" class="dynamometer" rx="3" />
                    <line x1="5" y1="10" x2="55" y2="10" stroke="#b7950b" stroke-width="1"/>
                    <rect id="dynaSpring" x="5" y="5" width="10" height="10" fill="#e74c3c" />
                    
                    <g transform="translate(60, 0)">
                        <path d="M 0 10 Q 5 2 10 10 Q 5 18 0 10" fill="none" stroke="#7f8c8d" stroke-width="2"/>
                    </g>
                </g>
            </g>
        </svg>
    </div>
</div>

<div class="report-panel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h3 id="table-title" style="margin:0;">Таблица результатов</h3>
        <button class="btn btn-check" id="btn-check" onclick="checkMath()">Проверить вычисления</button>
    </div>
    
    <table id="dataTable">
        <thead>
            <tr>
                <th id="th-1">№</th>
                <th id="th-2">Вес бруска<br>P, (Н)</th>
                <th id="th-3">Высота<br>h, (м)</th>
                <th id="th-4">Длина<br>l, (м)</th>
                <th id="th-5">Сила тяги<br>F, (Н)</th>
                <th id="th-6">Полезная работа<br>Aп = P·h (Дж)</th>
                <th id="th-7">Полная работа<br>Aз = F·l (Дж)</th>
                <th id="th-8">КПД<br>η = Aп/Aз · 100%</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>
    
    <div style="margin-top:10px; font-size:0.85rem; color:#555;">
        <strong id="help-title">Справка:</strong><br>
        <span id="help-1">1. Полезная работа (подъем груза): A<sub>полезная</sub> = P · h</span><br>
        <span id="help-2">2. Затраченная (полная) работа (тяга по наклонной): A<sub>затраченная</sub> = F · l</span><br>
        <span id="help-3">3. КПД показывает эффективность: η = (A<sub>пол</sub> / A<sub>затр</sub>) · 100%</span>
    </div>
</div>

<script>
    // --- ЛОКАЛИЗАЦИЯ ---
    const dict = {
        ru: {
            title: "Лаб. работа №10: Определение КПД наклонной плоскости",
            goal: "Цель: убедиться на опыте, что полезная работа меньше полной, и вычислить КПД.",
            params: "Параметры установки",
            weight: "Вес бруска (P):",
            len: "Длина доски (l):",
            height: "Высота наклона (h):",
            dyna: "Динамометр (Сила тяги F):",
            btnPull: "Тянуть брусок",
            btnRecord: "Записать измерения",
            tableTitle: "Таблица результатов",
            btnCheck: "Проверить вычисления",
            th1: "№",
            th2: "Вес бруска<br>P, (Н)",
            th3: "Высота<br>h, (м)",
            th4: "Длина<br>l, (м)",
            th5: "Сила тяги<br>F, (Н)",
            th6: "Полезная работа<br>Aп = P·h (Дж)",
            th7: "Полная работа<br>Aз = F·l (Дж)",
            th8: "КПД<br>η = Aп/Aз · 100%",
            helpTitle: "Справка:",
            help1: "1. Полезная работа (подъем груза): A<sub>полезная</sub> = P · h",
            help2: "2. Затраченная (полная) работа (тяга по наклонной): A<sub>затраченная</sub> = F · l",
            help3: "3. КПД показывает эффективность: η = (A<sub>пол</sub> / A<sub>затр</sub>) · 100%",
            unitM: "м",
            unitN: "Н"
        },
        kz: {
            title: "Зертхана №10: Көлбеу жазықтықтың ПӘК-ін анықтау",
            goal: "Мақсаты: пайдалы жұмыстың толық жұмыстан кем екеніне көз жеткізу және ПӘК-ті есептеу.",
            params: "Қондырғы параметрлері",
            weight: "Білеушенің салмағы (P):",
            len: "Тақтайдың ұзындығы (l):",
            height: "Көлбеу биіктігі (h):",
            dyna: "Динамометр (Тарту күші F):",
            btnPull: "Білеушені тарту",
            btnRecord: "Өлшеулерді жазу",
            tableTitle: "Нәтижелер кестесі",
            btnCheck: "Есептеулерді тексеру",
            th1: "№",
            th2: "Білеушенің салмағы<br>P, (Н)",
            th3: "Биіктік<br>h, (м)",
            th4: "Ұзындық<br>l, (м)",
            th5: "Тарту күші<br>F, (Н)",
            th6: "Пайдалы жұмыс<br>Aп = P·h (Дж)",
            th7: "Толық жұмыс<br>Aт = F·l (Дж)",
            th8: "ПӘК<br>η = Aп/Aт · 100%",
            helpTitle: "Анықтама:",
            help1: "1. Пайдалы жұмыс (жүкті көтеру): A<sub>пайдалы</sub> = P · h",
            help2: "2. Жұмсалған (толық) жұмыс (көлбеу бойымен тарту): A<sub>жұмсалған</sub> = F · l",
            help3: "3. ПӘК тиімділікті көрсетеді: η = (A<sub>пайд</sub> / A<sub>жұмс</sub>) · 100%",
            unitM: "м",
            unitN: "Н"
        }
    };

    let currentLang = 'ru';

    function toggleLang() {
        currentLang = currentLang === 'ru' ? 'kz' : 'ru';
        applyTranslations();
        updateSim(); // Чтобы обновить единицы измерения на экране
    }

    function applyTranslations() {
        const t = dict[currentLang];
        
        document.getElementById('main-title').innerText = t.title;
        document.getElementById('main-goal').innerText = t.goal;
        
        document.getElementById('lbl-params').innerText = t.params;
        document.getElementById('lbl-weight').innerText = t.weight;
        document.getElementById('lbl-len').innerText = t.len;
        document.getElementById('lbl-height').innerText = t.height;
        document.getElementById('lbl-dyna').innerText = t.dyna;
        
        document.getElementById('btn-pull').innerText = t.btnPull;
        document.getElementById('btn-record').innerText = t.btnRecord;
        
        document.getElementById('table-title').innerText = t.tableTitle;
        document.getElementById('btn-check').innerText = t.btnCheck;

        // Заголовки таблицы
        for(let i=1; i<=8; i++) {
            document.getElementById('th-'+i).innerHTML = t['th'+i];
        }

        // Справка
        document.getElementById('help-title').innerHTML = t.helpTitle;
        document.getElementById('help-1').innerHTML = t.help1;
        document.getElementById('help-2').innerHTML = t.help2;
        document.getElementById('help-3').innerHTML = t.help3;
    }

    // --- PHYSICS CONSTANTS ---
    const BOARD_LEN_M = 1.0; 
    const BLOCK_WEIGHT_N = 2.0; 
    const FRICTION_COEFF = 0.2; 
    
    // Scale for visual (px per meter)
    const PX_SCALE = 500; 
    const START_X = 100;
    const START_Y = 350;

    // State
    let currentH = 0.3;
    let currentF = 0;
    let isMoving = false;
    let experimentCount = 0;

    // --- INIT ---
    function init() {
        applyTranslations();
        updateSim();
    }

    // --- UPDATER ---
    function updateSim() {
        if(isMoving) return;

        const t = dict[currentLang];
        const hSlider = document.getElementById('heightRange');
        
        const sliderVal = parseInt(hSlider.value);
        currentH = (sliderVal / 100) * 1.0; 
        if(currentH > 0.8) currentH = 0.8; 

        document.getElementById('heightReadout').innerText = currentH.toFixed(2) + " " + t.unitM;
        
        // Physics Calc
        const sinA = currentH / BOARD_LEN_M;
        const angleRad = Math.asin(sinA);
        const angleDeg = angleRad * (180 / Math.PI);
        const cosA = Math.cos(angleRad);

        let fPull = 0;
        if(currentH === 0) {
             fPull = FRICTION_COEFF * BLOCK_WEIGHT_N;
        } else {
             fPull = (BLOCK_WEIGHT_N * sinA) + (FRICTION_COEFF * BLOCK_WEIGHT_N * cosA);
        }
        
        currentF = fPull;

        // --- RENDER ---
        const baseM = Math.sqrt((BOARD_LEN_M**2) - (currentH**2));
        const basePx = baseM * PX_SCALE;
        const heightPx = currentH * PX_SCALE;

        const p1 = `${START_X} ${START_Y}`;
        const p2 = `${START_X + basePx} ${START_Y}`; 
        const p3 = `${START_X + basePx} ${START_Y - heightPx}`; 

        document.getElementById('rampPath').setAttribute('d', `M ${p1} L ${p2} L ${p3} Z`);

        const hLine = document.getElementById('hLine');
        hLine.setAttribute('x1', START_X + basePx + 20);
        hLine.setAttribute('x2', START_X + basePx + 20);
        hLine.setAttribute('y1', START_Y);
        hLine.setAttribute('y2', START_Y - heightPx);

        const hText = document.getElementById('hText');
        hText.setAttribute('x', START_X + basePx + 30);
        hText.setAttribute('y', START_Y - (heightPx/2));
        hText.textContent = `h=${currentH.toFixed(2)}${t.unitM}`;

        const lText = document.getElementById('lText');
        lText.setAttribute('x', START_X + (basePx/2));
        lText.setAttribute('y', START_Y - (heightPx/2) - 20);
        lText.setAttribute('transform', `rotate(${-angleDeg} ${START_X + (basePx/2)} ${START_Y - (heightPx/2)})`);
        lText.textContent = `l=1.0${t.unitM}`;

        // Position Block (Start at bottom)
        const group = document.getElementById('moveGroup');
        group.setAttribute('transform', `translate(${START_X}, ${START_Y}) rotate(${-angleDeg}) translate(40, -21)`);

        // Reset UI
        document.getElementById('forceReadout').innerText = "---";
        document.getElementById('btn-record').disabled = true;
    }

    // --- ANIMATION ---
    function animatePull() {
        if(isMoving) return;
        isMoving = true;

        const t = dict[currentLang];
        const sinA = currentH / BOARD_LEN_M;
        const angleRad = Math.asin(sinA);
        const angleDeg = angleRad * (180 / Math.PI);
        const baseM = Math.sqrt((BOARD_LEN_M**2) - (currentH**2));
        const basePx = baseM * PX_SCALE;
        
        // Show Force
        document.getElementById('forceReadout').innerText = currentF.toFixed(2) + " " + t.unitN;
        
        // Spring visual stretch
        const springW = Math.min(50, 10 + (currentF * 10));
        document.getElementById('dynaSpring').setAttribute('width', springW);

        const group = document.getElementById('moveGroup');
        let start = null;
        const duration = 2000; // 2 sec

        function step(timestamp) {
            if (!start) start = timestamp;
            const progress = (timestamp - start) / duration;

            if (progress < 1) {
                const currentDist = 40 + (progress * (PX_SCALE - 80)); 
                group.setAttribute('transform', `translate(${START_X}, ${START_Y}) rotate(${-angleDeg}) translate(${currentDist}, -21)`);
                requestAnimationFrame(step);
            } else {
                isMoving = false;
                document.getElementById('btn-record').disabled = false;
            }
        }
        requestAnimationFrame(step);
    }

    // --- DATA HANDLING ---
    function recordData() {
        experimentCount++;
        const tbody = document.querySelector('#dataTable tbody');
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${experimentCount}</td>
            <td>${BLOCK_WEIGHT_N.toFixed(1)}</td>
            <td>${currentH.toFixed(2)}</td>
            <td>${BOARD_LEN_M.toFixed(1)}</td>
            <td>${currentF.toFixed(2)}</td>
            <td><input class="user-input a-useful" type="number" step="0.01"></td>
            <td><input class="user-input a-total" type="number" step="0.01"></td>
            <td><input class="user-input kpd" type="number" step="0.1"></td>
        `;
        
        // Store correct values in dataset for checking later
        const A_useful = BLOCK_WEIGHT_N * currentH;
        const A_total = currentF * BOARD_LEN_M;
        const KPD = (A_useful / A_total) * 100;

        row.dataset.u = A_useful.toFixed(2);
        row.dataset.t = A_total.toFixed(2);
        row.dataset.k = KPD.toFixed(1);

        tbody.appendChild(row);
        document.getElementById('btn-record').disabled = true;
        
        // Autoscroll
        const wrapper = document.querySelector('.report-panel');
        wrapper.scrollTop = wrapper.scrollHeight;
    }

    function checkMath() {
        const rows = document.querySelectorAll('#dataTable tbody tr');
        rows.forEach(row => {
            const uInput = row.querySelector('.a-useful');
            const tInput = row.querySelector('.a-total');
            const kInput = row.querySelector('.kpd');

            validate(uInput, row.dataset.u);
            validate(tInput, row.dataset.t);
            validate(kInput, row.dataset.k);
        });
    }

    function validate(input, correctVal) {
        if(input.value === "") return;
        const userVal = parseFloat(input.value);
        const target = parseFloat(correctVal);
        
        // Allow small error margin
        const error = Math.abs(userVal - target);
        let tolerance = 0.15;
        if(input.classList.contains('kpd')) tolerance = 1.0; // 1% for percentage

        if (error <= tolerance) {
            input.classList.add('correct');
            input.classList.remove('incorrect');
        } else {
            input.classList.add('incorrect');
            input.classList.remove('correct');
        }
    }

    // Start
    init();

</script>

</body>
</html>