<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Виртуальная физическая лаборатория</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --primary: #2c3e50; 
            --accent: #2980b9; 
            --bg: #fdfefe; 
            --panel: #ffffff; 
            --success: #27ae60; 
            --text: #34495e; 
            --error: #e74c3c;
        }
        
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* КНОПКА ПЕРЕКЛЮЧЕНИЯ В ПРАВОМ ВЕРХНЕМ УГЛУ */
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .lang-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .grid-container { display: grid; grid-template-columns: 350px 1fr; gap: 20px; max-width: 1400px; width: 100%; }
        .card { background: var(--panel); padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; position: relative; }
        
        h1 { color: var(--primary); border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; margin-top: 0; font-size: 1.6rem; }
        h2 { font-size: 1.2rem; margin-top: 0; color: #2c3e50; }
        h3 { font-size: 1.1rem; color: #7f8c8d; margin-bottom: 10px; font-weight: 600; border-left: 4px solid var(--accent); padding-left: 10px; }

        /* ФОРМУЛЫ */
        .formula-row { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 15px; margin: 15px 0; }
        .formula-box { background: #f8f9fa; padding: 15px; text-align: center; border-radius: 8px; border: 1px solid #dfe6e9; min-width: 180px; font-family: 'Times New Roman', serif; font-size: 1.3rem; font-style: italic; }
        .formula-desc { font-family: 'Segoe UI', sans-serif; font-size: 0.8rem; color: #7f8c8d; font-style: normal; margin-top: 8px; }
        .fraction { display: inline-block; vertical-align: middle; text-align: center; margin: 0 5px; }
        .fraction-top { border-bottom: 1px solid #000; display: block; padding: 0 2px; }
        .fraction-bottom { display: block; padding: 0 2px; }
        .sqrt-wrap { white-space: nowrap; display: inline-block; vertical-align: middle; }
        .sqrt-sym { font-size: 1.2em; vertical-align: bottom; }
        .sqrt-content { border-top: 1px solid #000; display: inline-block; margin-left: -2px; }

        /* УПРАВЛЕНИЕ */
        .control-group { margin-bottom: 20px; }
        label { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 8px; }
        input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; }
        .val-display { color: var(--accent); font-weight: bold; }
        
        .stopwatch { background: #34495e; color: #f1c40f; font-family: monospace; font-size: 2.2rem; text-align: center; padding: 10px; border-radius: 6px; margin: 15px 0; }
        .btn { border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; margin-top: 8px; color: white; }
        .btn-start { background: var(--success); }
        .btn-record { background: var(--accent); }
        .btn-reset { background: #95a5a6; }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; }

        /* СИМУЛЯЦИЯ */
        .simulation-card { grid-column: 2; height: 500px; display: flex; flex-direction: column; }
        .svg-container { flex-grow: 1; border: 1px solid #dfe6e9; background: #fff; border-radius: 8px; position: relative; overflow: hidden; }
        .floor { stroke: #2c3e50; stroke-width: 2; }
        .ball { fill: var(--error); }
        .ramp { stroke: #34495e; stroke-width: 5; fill: none; }

        /* ТАБЛИЦА */
        .table-container { grid-column: 1 / -1; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th, td { border: 1px solid #bdc3c7; padding: 10px; text-align: center; }
        th { background: #ecf0f1; }
    </style>
</head>
<body>

<div class="lang-switch">
    <button class="lang-btn" onclick="toggleLang()">RU / KZ</button>
</div>

<div class="grid-container">
    <div class="card" style="grid-column: 1 / -1;">
        <h1 id="txt-title">Лабораторная работа №4: Горизонтальный бросок</h1>
        <h3 id="txt-goal-label">Цель работы:</h3>
        <p id="txt-goal">Определить начальную скорость шарика и проверить законы кинематики.</p>
        
        <div class="formula-row">
            <div class="formula-box">
                <div>h = <div class="fraction"><span class="fraction-top">gt<sup>2</sup></span><span class="fraction-bottom">2</span></div></div>
                <div class="formula-desc" id="txt-f1">Высота падения</div>
            </div>
            <div class="formula-box">
                <div>L = v<sub>0</sub> &middot; t</div>
                <div class="formula-desc" id="txt-f2">Дальность полета</div>
            </div>
            <div class="formula-box" style="background: #eafaf1; border-color: var(--success);">
                <div>v<sub>0</sub> = L &middot; <span class="sqrt-wrap"><span class="sqrt-sym">&radic;</span><span class="sqrt-content"><div class="fraction"><span class="fraction-top">g</span><span class="fraction-bottom">2h</span></div></span></span></div>
                <div class="formula-desc" id="txt-f3">Расчетная скорость</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 id="txt-settings">Настройки</h2>
        <div class="control-group">
            <label><span id="txt-label-h">Высота (h)</span>: <span class="val-display"><span id="h-val">1.00</span> м</span></label>
            <input type="range" id="h-input" min="0.5" max="2.0" value="1.00" step="0.1" oninput="updateSetup()">
        </div>
        <div class="control-group">
            <label><span id="txt-label-v">Скорость (v₀)</span>: <span class="val-display"><span id="v0-val">3.00</span> м/с</span></label>
            <input type="range" id="v0-input" min="0" max="6.0" value="3.00" step="0.1" oninput="updateSetup()">
        </div>
        <div class="stopwatch" id="timer-display">0.000</div>
        <button class="btn btn-start" id="btn-start" onclick="startSequence()">▶ ЗАПУСК</button>
        <button class="btn btn-record" id="btn-record" onclick="recordData()" disabled>⬇ ЗАПИСАТЬ</button>
        <button class="btn btn-reset" onclick="resetSim()" id="txt-btn-reset">↺ СБРОС</button>
    </div>

    <div class="card simulation-card">
        <div class="svg-container">
            <svg id="sim-svg" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid meet">
                <rect width="100%" height="100%" fill="#f8f9fa" />
                <line x1="0" y1="450" x2="800" y2="450" class="floor" />
                <g id="ruler-marks"></g>
                <path d="" class="ramp" id="ramp-path" />
                <line x1="100" y1="250" x2="100" y2="450" stroke="#e67e22" stroke-dasharray="4" id="plumb-line" />
                <circle cx="100" cy="250" r="8" class="ball" id="ball" />
                <text x="-100" y="435" font-size="12" id="impact-text"></text>
            </svg>
        </div>
        <div style="padding: 10px; background: #ecf0f1; font-size: 0.9rem;">
            <strong id="txt-status-label">Статус:</strong> <span id="status-text">Готов</span>
        </div>
    </div>

    <div class="card table-container">
        <h2 id="txt-table-title">Журнал измерений</h2>
        <table id="data-table">
            <thead>
                <tr>
                    <th>№</th>
                    <th id="th-h">h (м)</th>
                    <th id="th-l">L (м)</th>
                    <th id="th-t">t (с)</th>
                    <th id="th-v">v₀ (м/с)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    const g = 9.8;
    const pxm = 130; // pixels per meter
    let lang = 'ru';

    const dictionary = {
        ru: {
            title: "Лабораторная работа №4: Горизонтальный бросок",
            goal_label: "Цель работы:",
            goal: "Определить начальную скорость шарика и проверить законы кинематики.",
            f1: "Высота падения", f2: "Дальность полета", f3: "Расчетная скорость",
            settings: "Настройки", label_h: "Высота (h)", label_v: "Скорость (v₀)",
            btn_start: "▶ ЗАПУСК", btn_record: "⬇ ЗАПИСАТЬ", btn_reset: "↺ СБРОС",
            status_label: "Статус:", status_ready: "Готов", status_roll: "Скатывание...", status_fly: "Полет...", status_done: "Упал. Запишите данные.",
            table: "Журнал измерений", th_h: "h (м)", th_l: "L (м)", th_t: "t (с)", th_v: "v₀ (м/с)"
        },
        kz: {
            title: "№4 Зертханалық жұмыс: Көлденең лақтыру",
            goal_label: "Жұмыс мақсаты:",
            goal: "Шардың бастапқы жылдамдығын анықтау және кинематика заңдарын тексеру.",
            f1: "Құлау биіктігі", f2: "Ұшу қашықтығы", f3: "Есептелген жылдамдық",
            settings: "Параметрлер", label_h: "Биіктік (h)", label_v: "Жылдамдық (v₀)",
            btn_start: "▶ ІСКЕ ҚОСУ", btn_record: "⬇ ЖАЗУ", btn_reset: "↺ ҚАЛПЫНА КЕЛТІРУ",
            status_label: "Күйі:", status_ready: "Дайын", status_roll: "Домалау...", status_fly: "Ұшу...", status_done: "Құлады. Мәліметті жазыңыз.",
            table: "Өлшеу журналы", th_h: "h (м)", th_l: "L (м)", th_t: "t (с)", th_v: "v₀ (м/с)"
        }
    };

    function toggleLang() {
        lang = lang === 'ru' ? 'kz' : 'ru';
        const d = dictionary[lang];
        document.getElementById('txt-title').innerText = d.title;
        document.getElementById('txt-goal-label').innerText = d.goal_label;
        document.getElementById('txt-goal').innerText = d.goal;
        document.getElementById('txt-f1').innerText = d.f1;
        document.getElementById('txt-f2').innerText = d.f2;
        document.getElementById('txt-f3').innerText = d.f3;
        document.getElementById('txt-settings').innerText = d.settings;
        document.getElementById('txt-label-h').innerText = d.label_h;
        document.getElementById('txt-label-v').innerText = d.label_v;
        document.getElementById('btn-start').innerText = d.btn_start;
        document.getElementById('btn-record').innerText = d.btn_record;
        document.getElementById('txt-btn-reset').innerText = d.btn_reset;
        document.getElementById('txt-status-label').innerText = d.status_label;
        document.getElementById('txt-table-title').innerText = d.table;
        document.getElementById('th-h').innerText = d.th_h;
        document.getElementById('th-l').innerText = d.th_l;
        document.getElementById('th-t').innerText = d.th_t;
        document.getElementById('th-v').innerText = d.th_v;
        updateSetup();
    }

    let h = 1.0, v0 = 3.0, isRunning = false;

    function updateSetup() {
        if(isRunning) return;
        h = parseFloat(document.getElementById('h-input').value);
        v0 = parseFloat(document.getElementById('v0-input').value);
        document.getElementById('h-val').innerText = h.toFixed(2);
        document.getElementById('v0-val').innerText = v0.toFixed(2);
        
        const exitY = 450 - h * pxm;
        document.getElementById('ramp-path').setAttribute("d", `M 40,${exitY-80} Q 40,${exitY} 100,${exitY}`);
        document.getElementById('plumb-line').setAttribute("y1", exitY);
        document.getElementById('plumb-line').setAttribute("x1", 100); document.getElementById('plumb-line').setAttribute("x2", 100);
        document.getElementById('ball').setAttribute("cx", 40); document.getElementById('ball').setAttribute("cy", exitY-80);
        document.getElementById('status-text').innerText = dictionary[lang].status_ready;
    }

    function startSequence() {
        isRunning = true;
        document.getElementById('btn-start').disabled = true;
        document.getElementById('status-text').innerText = dictionary[lang].status_roll;
        
        // Simple roll animation then flight
        setTimeout(() => {
            const exitY = 450 - h * pxm;
            document.getElementById('ball').setAttribute("cx", 100);
            document.getElementById('ball').setAttribute("cy", exitY);
            startFlight();
        }, 600);
    }

    function startFlight() {
        document.getElementById('status-text').innerText = dictionary[lang].status_fly;
        const t_fall = Math.sqrt((2 * h) / g);
        const start = performance.now();
        const exitY = 450 - h * pxm;

        function animate(now) {
            let elapsed = (now - start) / 1000;
            let t = Math.min(elapsed, t_fall);
            
            let x = 100 + (v0 * t * pxm);
            let y = exitY + (0.5 * g * t * t * pxm);
            
            document.getElementById('ball').setAttribute("cx", x);
            document.getElementById('ball').setAttribute("cy", y);
            document.getElementById('timer-display').innerText = t.toFixed(3);

            if(elapsed < t_fall) requestAnimationFrame(animate);
            else {
                isRunning = false;
                document.getElementById('btn-start').disabled = false;
                document.getElementById('btn-record').disabled = false;
                document.getElementById('status-text').innerText = dictionary[lang].status_done;
            }
        }
        requestAnimationFrame(animate);
    }

    function recordData() {
        const t = Math.sqrt((2 * h) / g);
        const L = v0 * t;
        const tbody = document.querySelector('#data-table tbody');
        tbody.innerHTML += `<tr><td>${tbody.children.length+1}</td><td>${h}</td><td>${L.toFixed(3)}</td><td>${t.toFixed(3)}</td><td>${v0}</td></tr>`;
        document.getElementById('btn-record').disabled = true;
    }

    function resetSim() { location.reload(); }

    updateSetup();
</script>
</body>
</html>