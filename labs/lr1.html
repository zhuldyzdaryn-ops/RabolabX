<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Лаб. работа №1: Равномерное движение</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #fdfefe; --panel: #ffffff; --success: #27ae60; --text: #34495e; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; position: relative; }
        
        /* КНОПКА ЯЗЫКА */
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .btn-lang {
            background: #34495e;
            color: white;
            border: 2px solid #2c3e50;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-lang:hover { background: #2c3e50; transform: translateY(-2px); }

        .grid-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            max-width: 1400px;
            width: 100%;
            margin-top: 40px;
        }

        .card { background: var(--panel); padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        h1 { color: var(--primary); border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; margin-top: 0; font-size: 1.6rem; }
        h2 { font-size: 1.2rem; margin-top: 0; color: #2c3e50; }
        h3 { font-size: 1.1rem; color: #7f8c8d; margin-bottom: 10px; font-weight: 600; border-left: 4px solid var(--accent); padding-left: 10px; }

        /* --- ФОРМУЛЫ (HTML/CSS) --- */
        .formula-row { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 15px; margin: 15px 0; }
        .formula-box { 
            background: #f8f9fa; padding: 15px; text-align: center; border-radius: 8px; 
            border: 1px solid #dfe6e9; min-width: 200px;
            font-family: 'Times New Roman', serif; font-size: 1.4rem; font-style: italic;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .formula-desc { font-family: 'Segoe UI', sans-serif; font-size: 0.85rem; color: #7f8c8d; font-style: normal; margin-top: 8px; }
        
        .fraction { display: inline-block; text-align: center; vertical-align: middle; margin: 0 4px; }
        .fraction-top { border-bottom: 1px solid #000; display: block; padding: 0 2px 2px 2px; }
        .fraction-bottom { display: block; padding: 2px 2px 0 2px; }

        /* УПРАВЛЕНИЕ */
        .control-group { margin-bottom: 20px; }
        label { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 8px; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--accent); }
        .val-display { color: var(--accent); font-weight: bold; font-family: monospace; font-size: 1.1em; }
        
        .stopwatch {
            background: #2c3e50; color: #f1c40f; font-family: 'Courier New', monospace; 
            font-size: 2.5rem; text-align: center; padding: 10px; border-radius: 6px; margin: 20px 0;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .btn { border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; margin-top: 8px; color: white; font-size: 1rem; }
        .btn-start { background: var(--success); }
        .btn-start:disabled { background: #bdc3c7; cursor: not-allowed; }
        .btn-start:hover:not(:disabled) { background: #219150; }
        .btn-record { background: var(--accent); }
        .btn-record:disabled { background: #bdc3c7; cursor: not-allowed; }
        .btn-reset { background: #95a5a6; }

        /* СИМУЛЯЦИЯ */
        .simulation-card { grid-column: 2; grid-row: 2 / 3; height: 550px; display: flex; flex-direction: column; }
        .svg-container { 
            flex-grow: 1; border: 1px solid #dfe6e9; background: #fff; border-radius: 8px; 
            position: relative; overflow: hidden; 
            display: flex; justify-content: center; align-items: center;
        }
        
        /* Элементы SVG */
        .cylinder-wall { fill: none; stroke: #7f8c8d; stroke-width: 3; }
        .cylinder-water { fill: #d6eaf8; opacity: 0.6; }
        .tick { stroke: #2c3e50; stroke-width: 1; }
        .tick-text { font-size: 11px; fill: #2c3e50; font-family: sans-serif; }
        .vessel { fill: #e67e22; stroke: #d35400; stroke-width: 1; rx: 5; } /* Всплывающее тело */
        .bubbles { fill: #fff; opacity: 0.5; }
        
        .limit-line { stroke: #e74c3c; stroke-width: 2; stroke-dasharray: 5,3; }

        /* ТАБЛИЦА */
        .table-container { grid-column: 1 / -1; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th, td { border: 1px solid #bdc3c7; padding: 10px; text-align: center; }
        th { background-color: #ecf0f1; }
        .current-row { background-color: #e8f8f5; border-left: 4px solid var(--success); }

        /* ГРАФИКИ */
        .charts-container { grid-column: 1 / -1; display: grid; grid-template-columns: 1fr; gap: 20px; }
        canvas { width: 100%; max-height: 300px; }
    </style>
</head>
<body>

<div class="lang-switch">
    <button class="btn-lang" onclick="toggleLanguage()">RU | KZ</button>
</div>

<div class="grid-container">

    <div class="card" style="grid-column: 1 / -1;">
        <h1 id="t-main-title">Лабораторная работа №1: Измерение скорости равномерного движения</h1>
        
        <h3 id="t-goal-header">Цель работы:</h3>
        <p id="t-goal-text">Определить среднюю скорость равномерного движения сосуда при всплытии в мерном цилиндре.</p>
        
        <div class="formula-row">
            <div class="formula-box" style="background: #eafaf1; border-color: #27ae60;">
                <div>
                    v<sub>ср</sub> = <div class="fraction">
                        <span class="fraction-top">S</span>
                        <span class="fraction-bottom">t</span>
                    </div>
                </div>
                <div class="formula-desc" id="t-formula-speed">Формула скорости</div>
            </div>
            
            <div class="formula-box">
                <div>S (мм) = k &middot; V (мл)</div>
                <div class="formula-desc" id="t-formula-conv">Перевод объема в путь<br>(k &approx; 0.8 мм/мл)</div>
            </div>

            <div class="formula-box">
                <div>S = v &middot; t</div>
                <div class="formula-desc" id="t-formula-eq">Уравнение движения</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 id="t-settings-header">Настройки опыта</h2>
        
        <div class="control-group">
            <label><span id="t-label-finish">Отметка финиша (V):</span> <span class="val-display"><span id="target-v-val">250</span> <span id="t-unit-ml">мл</span></span></label>
            <input type="range" id="target-v-input" min="50" max="250" value="250" step="10" oninput="updateSetup()">
            <small style="color: #7f8c8d;"><span id="t-path-approx">Путь S &approx;</span> <span id="s-calc-display">200</span> <span id="t-unit-mm">мм</span></small>
        </div>

        <div class="control-group">
            <label><span id="t-label-density">Плотность среды (скорость):</span> <span class="val-display" id="speed-label">Средняя</span></label>
            <input type="range" id="speed-input" min="10" max="100" value="50" step="1" oninput="updateSetup()">
            <small style="color: #7f8c8d;" id="t-speed-desc">Влияет на скорость всплытия</small>
        </div>
        
        <div class="stopwatch">
            <span id="timer-display">0.000</span>
        </div>

        <button class="btn btn-start" id="btn-start" onclick="startSimulation()">▶ <span id="t-btn-start">ЗАПУСК (Всплытие)</span></button>
        <button class="btn btn-record" id="btn-record" onclick="recordData()" disabled>⬇ <span id="t-btn-record">ЗАПИСАТЬ РЕЗУЛЬТАТ</span></button>
        <button class="btn btn-reset" onclick="resetSim()">↺ <span id="t-btn-reset">СБРОС (На дно)</span></button>
    </div>

    <div class="card simulation-card">
        <div class="svg-container">
            <svg id="sim-svg" viewBox="0 0 300 450" preserveAspectRatio="xMidYMid meet" style="height: 100%;">
                
                <rect x="100" y="50" width="100" height="350" class="cylinder-water" />
                
                <line x1="100" y1="40" x2="100" y2="400" class="cylinder-wall" /> <line x1="200" y1="40" x2="200" y2="400" class="cylinder-wall" /> <path d="M 100,400 Q 150,420 200,400" class="cylinder-wall" /> <g id="scale-group"></g>

                <line x1="90" y1="-100" x2="210" y2="-100" class="limit-line" id="finish-line" />
                <text x="215" y="-100" font-size="12" fill="#e74c3c" alignment-baseline="middle" id="finish-text">Финиш</text>

                <g id="vessel-group" transform="translate(150, 380)">
                    <rect x="-15" y="-20" width="30" height="40" class="vessel" />
                    <circle cx="0" cy="-25" r="2" class="bubbles" id="bub1" />
                    <circle cx="-5" cy="-30" r="1.5" class="bubbles" id="bub2" />
                </g>

                <text x="80" y="380" font-size="12" fill="#7f8c8d" text-anchor="end">0 мл</text>

            </svg>
        </div>
        <div style="padding: 10px; background: #ecf0f1; border-top: 1px solid #ddd;">
            <strong><span id="t-status-label">Статус:</span></strong> <span id="status-text">Готов к запуску</span>
        </div>
    </div>

    <div class="card table-container">
        <div style="display: flex; justify-content: space-between;">
            <h2 id="t-table-header">Таблица измерений</h2>
            <button class="btn" style="width: auto; background: #e74c3c; padding: 5px 15px;" id="t-btn-clear" onclick="clearTable()">Очистить</button>
        </div>
        <table id="data-table">
            <thead>
                <tr>
                    <th id="t-col-no">№</th>
                    <th id="t-col-vol">Объем V (мл)</th>
                    <th id="t-col-path">Путь S (мм)</th>
                    <th id="t-col-time">Время t (с)</th>
                    <th id="t-col-speed">Скорость v (мм/с)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="charts-container">
        <div class="card">
            <h3 id="t-chart-header">График зависимости пути от времени S(t)</h3>
            <canvas id="chartSt"></canvas>
            <p style="text-align: center; color: #7f8c8d; font-size: 0.9em;" id="t-chart-sub">(Должна получиться прямая, выходящая из начала координат)</p>
        </div>
    </div>

</div>

<script>
    // --- ЯЗЫКОВАЯ ЛОГИКА ---
    let currentLang = 'ru';

    const translations = {
        ru: {
            't-main-title': 'Лабораторная работа №1: Измерение скорости равномерного движения',
            't-goal-header': 'Цель работы:',
            't-goal-text': 'Определить среднюю скорость равномерного движения сосуда при всплытии в мерном цилиндре.',
            't-formula-speed': 'Формула скорости',
            't-formula-conv': 'Перевод объема в путь<br>(k &approx; 0.8 мм/мл)',
            't-formula-eq': 'Уравнение движения',
            't-settings-header': 'Настройки опыта',
            't-label-finish': 'Отметка финиша (V):',
            't-path-approx': 'Путь S &approx;',
            't-label-density': 'Плотность среды (скорость):',
            't-speed-desc': 'Влияет на скорость всплытия',
            't-btn-start': 'ЗАПУСК (Всплытие)',
            't-btn-record': 'ЗАПИСАТЬ РЕЗУЛЬТАТ',
            't-btn-reset': 'СБРОС (На дно)',
            't-status-label': 'Статус:',
            't-table-header': 'Таблица измерений',
            't-btn-clear': 'Очистить',
            't-col-no': '№',
            't-col-vol': 'Объем V (мл)',
            't-col-path': 'Путь S (мм)',
            't-col-time': 'Время t (с)',
            't-col-speed': 'Скорость v (мм/с)',
            't-chart-header': 'График зависимости пути от времени S(t)',
            't-chart-sub': '(Должна получиться прямая, выходящая из начала координат)',
            't-unit-ml': 'мл',
            't-unit-mm': 'мм',
            // Chart labels
            'chart-label-points': 'Экспериментальные точки',
            'chart-label-trend': 'Линия тренда',
            'chart-x-time': 'Время t (с)',
            'chart-y-path': 'Путь S (мм)',
            // Dynamic text (for speed label & status)
            'status-ready': 'Готов к запуску',
            'status-rising': 'Всплытие...',
            'status-finish': 'Финиш. Запишите результат.',
            'status-recorded': 'Записано.',
            'speed-slow': 'Медленно (Вязко)',
            'speed-fast': 'Быстро',
            'speed-norm': 'Норма',
            'finish-label': 'Финиш'
        },
        kz: {
            't-main-title': 'Зертханалық жұмыс №1: Бірқалыпты қозғалыс жылдамдығын өлшеу',
            't-goal-header': 'Жұмыс мақсаты:',
            't-goal-text': 'Өлшеуіш цилиндрде қалқып шығу кезіндегі ыдыстың бірқалыпты қозғалысының орташа жылдамдығын анықтау.',
            't-formula-speed': 'Жылдамдық формуласы',
            't-formula-conv': 'Көлемді жолға айналдыру<br>(k &approx; 0.8 мм/мл)',
            't-formula-eq': 'Қозғалыс теңдеуі',
            't-settings-header': 'Тәжірибе баптаулары',
            't-label-finish': 'Мәре белгісі (V):',
            't-path-approx': 'Жол S &approx;',
            't-label-density': 'Ортаның тығыздығы (жылдамдық):',
            't-speed-desc': 'Қалқып шығу жылдамдығына әсер етеді',
            't-btn-start': 'ІСКЕ ҚОСУ (Қалқу)',
            't-btn-record': 'НӘТИЖЕНІ ЖАЗУ',
            't-btn-reset': 'ҚАЙТАРУ (Түбіне)',
            't-status-label': 'Күйі:',
            't-table-header': 'Өлшеу кестесі',
            't-btn-clear': 'Тазалау',
            't-col-no': '№',
            't-col-vol': 'Көлем V (мл)',
            't-col-path': 'Жол S (мм)',
            't-col-time': 'Уақыт t (с)',
            't-col-speed': 'Жылдамдық v (мм/с)',
            't-chart-header': 'Жолдың уақытқа тәуелділік графигі S(t)',
            't-chart-sub': '(Координаталар басынан шығатын түзу болуы керек)',
            't-unit-ml': 'мл',
            't-unit-mm': 'мм',
            // Chart labels
            'chart-label-points': 'Тәжірибелік нүктелер',
            'chart-label-trend': 'Тренд сызығы',
            'chart-x-time': 'Уақыт t (с)',
            'chart-y-path': 'Жол S (мм)',
            // Dynamic text
            'status-ready': 'Іске қосуға дайын',
            'status-rising': 'Қалқып шығу...',
            'status-finish': 'Мәре. Нәтижені жазыңыз.',
            'status-recorded': 'Жазылды.',
            'speed-slow': 'Баяу (Тұтқыр)',
            'speed-fast': 'Жылдам',
            'speed-norm': 'Қалыпты',
            'finish-label': 'Мәре'
        }
    };

    function toggleLanguage() {
        currentLang = currentLang === 'ru' ? 'kz' : 'ru';
        const t = translations[currentLang];

        // Обновляем статические тексты
        for (const [id, text] of Object.entries(t)) {
            const el = document.getElementById(id);
            if (el) {
                if (id === 't-formula-conv') {
                    el.innerHTML = text; 
                } else {
                    el.innerText = text;
                }
            }
        }

        // Обновляем SVG текст
        ui.finishText.textContent = `${ui.finishText.textContent.split(' ')[0]} ${currentLang === 'ru' ? 'мл' : 'мл'}`; // Keep value update logic simple or re-trigger updateSetup
        
        // Обновляем график
        if (chartSt) {
            chartSt.data.datasets[0].label = t['chart-label-points'];
            chartSt.data.datasets[1].label = t['chart-label-trend'];
            chartSt.options.scales.x.title.text = t['chart-x-time'];
            chartSt.options.scales.y.title.text = t['chart-y-path'];
            chartSt.update();
        }

        // Обновляем динамические тексты (статус, скорость)
        updateSetup(); 
    }

    // === КОНСТАНТЫ ===
    const CYLINDER_BOTTOM_Y = 380; // Y координата 0 мл
    const CYLINDER_TOP_Y = 80;      // Y координата 250 мл
    const MAX_VOL = 250;           // Макс объем
    const PIXELS_HEIGHT = CYLINDER_BOTTOM_Y - CYLINDER_TOP_Y; // Высота столба в пикселях
    
    // Коэффициент перевода: 250 мл = 200 мм (примерно по PDF)
    // k = 0.8 мм/мл
    const K_MM_PER_ML = 0.8; 
    
    // Состояние
    let targetVol = 250;
    let baseSpeed = 50; // Условные единицы
    let measuredTime = 0;
    let actualDistMm = 0;

    let isRunning = false;
    let animFrame = null;

    // UI
    const ui = {
        targetVInput: document.getElementById('target-v-input'),
        speedInput: document.getElementById('speed-input'),
        targetVVal: document.getElementById('target-v-val'),
        speedLabel: document.getElementById('speed-label'),
        sCalcDisplay: document.getElementById('s-calc-display'),
        timer: document.getElementById('timer-display'),
        status: document.getElementById('status-text'),
        
        scaleGroup: document.getElementById('scale-group'),
        vesselGroup: document.getElementById('vessel-group'),
        finishLine: document.getElementById('finish-line'),
        finishText: document.getElementById('finish-text'),
        
        btnStart: document.getElementById('btn-start'),
        btnRecord: document.getElementById('btn-record'),
        tableBody: document.querySelector('#data-table tbody')
    };

    // ГРАФИК
    const ctx = document.getElementById('chartSt').getContext('2d');
    const chartSt = new Chart(ctx, {
        type: 'line',
        data: { 
            datasets: [{
                label: 'Экспериментальные точки',
                data: [{x:0, y:0}], // Начальная точка
                borderColor: '#3498db',
                backgroundColor: '#3498db',
                pointRadius: 6,
                showLine: false // Показываем только точки
            },
            {
                label: 'Линия тренда',
                data: [],
                borderColor: '#e74c3c',
                borderWidth: 1,
                pointRadius: 0,
                borderDash: [5, 5]
            }] 
        },
        options: {
            responsive: true,
            scales: {
                x: { type: 'linear', position: 'bottom', title: {display:true, text: 'Время t (с)'}, min: 0 },
                y: { title: {display:true, text: 'Путь S (мм)'}, min: 0 }
            }
        }
    });

    // === ЛОГИКА ===

    function initScale() {
        let svgHtml = '';
        // Рисуем деления каждые 10 мл, большие каждые 50
        for (let v = 0; v <= MAX_VOL; v += 10) {
            // Интерполяция Y: 0 мл -> BOTTOM, 250 мл -> TOP
            const ratio = v / MAX_VOL;
            const y = CYLINDER_BOTTOM_Y - ratio * PIXELS_HEIGHT;
            
            let len = 5;
            if (v % 50 === 0) {
                len = 10;
                // Текст только для больших
                svgHtml += `<text x="85" y="${y+4}" class="tick-text" text-anchor="end">${v}</text>`;
            }
            svgHtml += `<line x1="100" y1="${y}" x2="${100+len}" y2="${y}" class="tick" />`;
            // Правая сторона тоже
            svgHtml += `<line x1="${200-len}" y1="${y}" x2="200" y2="${y}" class="tick" />`;
        }
        ui.scaleGroup.innerHTML = svgHtml;
    }

    function updateSetup() {
        if (isRunning) return;

        targetVol = parseInt(ui.targetVInput.value);
        baseSpeed = parseInt(ui.speedInput.value);
        
        const t = translations[currentLang];

        ui.targetVVal.innerText = targetVol;
        
        // Dynamic speed label translation
        if (baseSpeed < 40) ui.speedLabel.innerText = t['speed-slow'];
        else if (baseSpeed > 70) ui.speedLabel.innerText = t['speed-fast'];
        else ui.speedLabel.innerText = t['speed-norm'];
        
        // Расчет пути в мм
        actualDistMm = targetVol * K_MM_PER_ML;
        ui.sCalcDisplay.innerText = actualDistMm.toFixed(1);

        // Позиция линии финиша
        const ratio = targetVol / MAX_VOL;
        const finishY = CYLINDER_BOTTOM_Y - ratio * PIXELS_HEIGHT;
        
        ui.finishLine.setAttribute("y1", finishY);
        ui.finishLine.setAttribute("y2", finishY);
        ui.finishText.setAttribute("y", finishY);
        ui.finishText.textContent = `${t['finish-label']} ${targetVol} ${t['t-unit-ml']}`;

        // Сброс тела на дно
        ui.vesselGroup.setAttribute("transform", `translate(150, ${CYLINDER_BOTTOM_Y})`);

        ui.timer.innerText = "0.000";
        ui.status.innerText = t['status-ready'];
        ui.btnRecord.disabled = true;
    }

    function startSimulation() {
        if (isRunning) return;
        isRunning = true;
        ui.btnStart.disabled = true;
        ui.btnRecord.disabled = true;
        
        const t = translations[currentLang];
        
        // Сброс на дно
        ui.vesselGroup.setAttribute("transform", `translate(150, ${CYLINDER_BOTTOM_Y})`);

        // Физика: v = const. 
        // Скорость в мм/с (виртуальная) зависит от слайдера.
        // Пусть слайдер 50 = 40 мм/с.
        const v_mm_s = baseSpeed * 0.8; 
        
        // Время движения
        const t_ideal = actualDistMm / v_mm_s;
        
        // Небольшая погрешность реакции
        const error = (Math.random() - 0.5) * 0.1;
        measuredTime = t_ideal + error;
        if (measuredTime < 0.1) measuredTime = t_ideal;

        let startTime = null;
        const duration = measuredTime * 1000;
        
        // Высота подъема в пикселях
        const ratio = targetVol / MAX_VOL;
        const distPx = ratio * PIXELS_HEIGHT;

        ui.status.innerText = t['status-rising'];

        function animate(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;
            const t_curr = Math.min(elapsed / 1000, measuredTime);

            // S = v*t (линейно)
            const progress = t_curr / measuredTime;
            const currentLiftPx = distPx * progress;
            const currentY = CYLINDER_BOTTOM_Y - currentLiftPx;

            ui.vesselGroup.setAttribute("transform", `translate(150, ${currentY})`);
            ui.timer.innerText = t_curr.toFixed(3);
            
            // Анимация пузырьков (просто колебание)
            const wobble = Math.sin(timestamp/200) * 2;
            document.getElementById('bub1').setAttribute("cx", wobble);
            document.getElementById('bub2').setAttribute("cx", -5 - wobble);

            if (elapsed < duration) {
                animFrame = requestAnimationFrame(animate);
            } else {
                finishRun();
            }
        }
        animFrame = requestAnimationFrame(animate);
    }

    function finishRun() {
        isRunning = false;
        ui.btnStart.disabled = false;
        ui.btnRecord.disabled = false;
        const t = translations[currentLang];
        
        // Точная позиция
        const ratio = targetVol / MAX_VOL;
        const finishY = CYLINDER_BOTTOM_Y - ratio * PIXELS_HEIGHT;
        ui.vesselGroup.setAttribute("transform", `translate(150, ${finishY})`);
        
        ui.timer.innerText = measuredTime.toFixed(3);
        ui.status.innerText = t['status-finish'];
    }

    function resetSim() {
        if(animFrame) cancelAnimationFrame(animFrame);
        isRunning = false;
        ui.btnStart.disabled = false;
        updateSetup();
    }

    // === ТАБЛИЦА ===

    function recordData() {
        ui.btnRecord.disabled = true;
        const t = translations[currentLang];
        
        const timeVal = parseFloat(measuredTime.toFixed(3));
        const s = parseFloat(actualDistMm.toFixed(1));
        const v = s / timeVal;

        const tbody = ui.tableBody;
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>${tbody.children.length + 1}</td>
            <td>${targetVol}</td>
            <td>${s}</td>
            <td>${timeVal}</td>
            <td><strong>${v.toFixed(1)}</strong></td>
        `;
        tbody.appendChild(row);

        addPointToGraph(timeVal, s);
        ui.status.innerText = t['status-recorded'];
    }

    function addPointToGraph(time, dist) {
        // Добавляем точку
        chartSt.data.datasets[0].data.push({x: time, y: dist});
        
        // Обновляем линию тренда (от 0 до макс точки)
        // Ищем макс время и макс путь
        const points = chartSt.data.datasets[0].data;
        const maxT = Math.max(...points.map(p => p.x));
        const maxS = Math.max(...points.map(p => p.y));
        
        // Линия от (0,0) до последней точки (грубое приближение для визуализации равномерности)
        chartSt.data.datasets[1].data = [
            {x: 0, y: 0},
            {x: maxT, y: maxS}
        ];
        
        chartSt.update();
    }

    function clearTable() {
        ui.tableBody.innerHTML = '';
        chartSt.data.datasets[0].data = [{x:0, y:0}];
        chartSt.data.datasets[1].data = [];
        chartSt.update();
    }

    initScale();
    updateSetup();

</script>
</body>
</html>